<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>RubyCritic</title>
    <link href="../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <header class="project-header group">
      <div class="container">
        <h1 class="logo"><a href="../../overview.html" class="logo-link">RubyCritic</a></h1>
        <nav class="project-nav">
          <a href="../../overview.html" class="project-nav-item">Overview</a>
          <a href="../../code_index.html" class="project-nav-item">Code</a>
          <a href="../../smells_index.html" class="project-nav-item">Smells</a>
        </nav>
      </div>
    </header>
    <div class="container">
      <div class="file-header group rated">
  <span class="rating rating-f circled-text circle">
    F
  </span>
  <h2 class="file-name">StocksController</h2>

  <span class="file-committed-at">
    
      Updated <time class='js-timeago' datetime='2015-11-19 20:52:06 +0530'>2015-11-19 20:52:06 +0530</time>
    
  </span>

  <div class="file-stats group">
    <div class="file-stat">
      794 complexity
    </div>
    <div class="file-stat">
      56.7 complexity per method
    </div>
    <div class="file-stat">
      14 churn
    </div>
    <div class="file-stat">
      14 methods
    </div>
    <div class="file-stat">
      235 duplication
    </div>
  </div>

  
    <button id="js-toggle-smells" class="smells-toggle-button button">Toggle Smells</button>
  
</div>

<code class="prettyprint linenums lang-ruby file-code js-file-code">class StocksController &lt; ApplicationController<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(IrresponsibleModule) StocksController has no descriptive comment          </span>  </li>  <li class="smell old">    <span class="description">(TooManyInstanceVariables) StocksController has at least 7 instance variables          </span>  </li></ul>
  before_action :authenticate_user!
  #  authentiacation to access only show and update the data , not destroy or edit
  before_action :set_stock, only: [ :update,:show]

  # GET /stocks
  # GET /stocks.json
  def index
    @stocks = Stock.where(&quot;user_id = ?&quot; ,  current_user.id)
  end

  # GET /stocks/1
  # GET /stocks/1.json
  def show
  end

  # GET /stocks/new
  def new
    @stock = Stock.new

  end
  # GET /stocks/1/edit
  def edit

  end

  def expiry_date
      @date = Stock.where(&#39;item_name = ? and batch_number = ? and user_id = ? &#39;, params[:item] , params[:batch] , current_user.id).pluck(:expiry_date )
      render json: @date

  end

  def batch
     @batch = Stock.where(&#39;item_name = ? and user_id  = ?&#39; , params[:name], current_user.id).distinct.pluck(:batch_number )
     render json: @batch
  end

  def item
      @item = Report.where(&quot;user_id = ?&quot; , current_user.id).pluck(:item_name )
      render json: @item
  end

  # POST /stocks
  # POST /stocks.json
  def create<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(VeryHighComplexity) StocksController#create has a flog score of 321          </span>  </li>  <li class="smell old">    <span class="description">(TooManyStatements) StocksController#create has approx 69 statements          </span>  </li></ul>
    @stock = Stock.new(stock_params)
    @stock.user_id = current_user.id<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls current_user.id 11 times                        <a href="stocks_controller.html#L47" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L48" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">10</a>                  </span>  </li></ul>
    @item = Stock.where(&quot;user_id = ? and item_name = ?&quot; ,  current_user.id , @stock.item_name )<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.item_name 12 times                        <a href="stocks_controller.html#L48" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L67" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls current_user.id 11 times                        <a href="stocks_controller.html#L47" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L48" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">10</a>                  </span>  </li></ul>
    @uom = Stock.where(&quot;user_id = ? and item_name = ? and unit_of_measure = ?&quot; ,  current_user.id , @stock.item_name , @stock.unit_of_measure)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.item_name 12 times                        <a href="stocks_controller.html#L48" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L67" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.unit_of_measure 6 times                        <a href="stocks_controller.html#L49" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L74" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L114" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L137" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls current_user.id 11 times                        <a href="stocks_controller.html#L47" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L48" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">10</a>                  </span>  </li></ul>
    @stocks = Stock.where(&quot;user_id = ? and item_name = ? and unit_of_measure = ? and batch_number = ? &quot; ,  current_user.id , @stock.item_name , @stock.unit_of_measure , @stock.batch_number)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.batch_number 4 times                        <a href="stocks_controller.html#L50" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L77" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L114" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L137" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.item_name 12 times                        <a href="stocks_controller.html#L48" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L67" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.unit_of_measure 6 times                        <a href="stocks_controller.html#L49" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L74" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L114" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L137" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls current_user.id 11 times                        <a href="stocks_controller.html#L47" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L48" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">10</a>                  </span>  </li></ul>
    time = Time.now.strftime(&quot;%Y-%m-%d&quot;)
    respond_to do |format|
        if @stock.expiry_date &lt;= Date.parse(time)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.expiry_date 4 times                        <a href="stocks_controller.html#L53" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">3</a>                  </span>  </li></ul>
            format.html { redirect_to @stock, notice: &#39;Product is alreday expired, check the  expiry date&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.html 11 times                        <a href="stocks_controller.html#L54" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L57" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L92" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L95" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L100" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L125" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L131" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L147" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L154" class="js-smell-location">10</a>                  </span>  </li></ul>

        elsif @stock.quantity &lt;= 0<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity 13 times                        <a href="stocks_controller.html#L56" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L75" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L83" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L88" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">11</a>                  <a href="stocks_controller.html#L141" class="js-smell-location">12</a>                  </span>  </li></ul>
            format.html { redirect_to @stock, notice: &#39;Quantity should be positive&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.html 11 times                        <a href="stocks_controller.html#L54" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L57" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L92" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L95" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L100" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L125" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L131" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L147" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L154" class="js-smell-location">10</a>                  </span>  </li></ul>

        else
            if !@stocks.present?

                 master =  Master.where(&quot;item_name = ? and uom = ?&quot; , @stock.item_name , @stock.unit_of_measure)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.item_name 12 times                        <a href="stocks_controller.html#L48" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L67" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.unit_of_measure 6 times                        <a href="stocks_controller.html#L49" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L74" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L114" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L137" class="js-smell-location">5</a>                  </span>  </li></ul>

                #   if item is not in masters then consider it as personal item
                    if master.present?
                        # base is master&#39;s row with level = 1 , to get base uom
                        base = Master.where(&quot;item_name = ?&quot; , @stock.item_name )<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.item_name 12 times                        <a href="stocks_controller.html#L48" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L67" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">11</a>                  </span>  </li></ul>
                        base = base.where(&quot;level = ? &quot; , &quot;1&quot;)
                        uom = base.pluck(:uom)
                        uom = uom[0]
                        mrp = base.pluck(:mrp)
                        mrp = mrp[0]
                        #  onlt if given unit_of_measure is base_uom(level=1)
                        if uom.to_s == @stock.unit_of_measure.to_s<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.unit_of_measure 6 times                        <a href="stocks_controller.html#L49" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L74" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L114" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L137" class="js-smell-location">5</a>                  </span>  </li></ul>
                            price = @stock.quantity*mrp<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity 13 times                        <a href="stocks_controller.html#L56" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L75" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L83" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L88" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">11</a>                  <a href="stocks_controller.html#L141" class="js-smell-location">12</a>                  </span>  </li></ul>
                            purchase=Purchase.create(user_id: current_user.id , wholesaler: &quot;Stock Correction&quot;,item_name: @stock.item_name ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.item_name 12 times                        <a href="stocks_controller.html#L48" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L67" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls current_user.id 11 times                        <a href="stocks_controller.html#L47" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L48" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">10</a>                  </span>  </li></ul>
                            batch_number: @stock.batch_number ,unit_of_measure: uom ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.batch_number 4 times                        <a href="stocks_controller.html#L50" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L77" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L114" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L137" class="js-smell-location">3</a>                  </span>  </li></ul>
                            expiry_date: @stock.expiry_date , quantity:@stock.quantity , date_of_purchase: time , total_price:price)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.expiry_date 4 times                        <a href="stocks_controller.html#L53" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity 13 times                        <a href="stocks_controller.html#L56" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L75" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L83" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L88" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">11</a>                  <a href="stocks_controller.html#L141" class="js-smell-location">12</a>                  </span>  </li></ul>

                            # update in report
                            report = Report.find_by(item_name: @stock.item_name , user_id: current_user.id)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.item_name 12 times                        <a href="stocks_controller.html#L48" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L67" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls Report.find_by(item_name: @stock.item_name, user_id: current_user.id) 2 times                        <a href="stocks_controller.html#L81" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls current_user.id 11 times                        <a href="stocks_controller.html#L47" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L48" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">10</a>                  </span>  </li></ul>
                            if report.present?
                              report.value = (price + report.value*report.quantity)/(@stock.quantity + report.quantity)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls (price + (report.value * report.quantity)) / (@stock.quantity + report.quantity) 2 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity + report.quantity 2 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity 13 times                        <a href="stocks_controller.html#L56" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L75" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L83" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L88" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">11</a>                  <a href="stocks_controller.html#L141" class="js-smell-location">12</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls price + (report.value * report.quantity) 2 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.quantity 6 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.value * report.quantity 2 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.value 3 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.value = ((price + (report.value * report.quantity)) / (@stock.quantity + report.quantity)) 2 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">1</a>                  </span>  </li></ul>
                              report.quantity = report.quantity + @stock.quantity<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity 13 times                        <a href="stocks_controller.html#L56" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L75" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L83" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L88" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">11</a>                  <a href="stocks_controller.html#L141" class="js-smell-location">12</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.quantity + @stock.quantity 2 times                        <a href="stocks_controller.html#L84" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.quantity 6 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.quantity = (report.quantity + @stock.quantity) 2 times                        <a href="stocks_controller.html#L84" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">1</a>                  </span>  </li></ul>
                              report.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.save 2 times                        <a href="stocks_controller.html#L85" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L119" class="js-smell-location">1</a>                  </span>  </li></ul>
                            else
                              report=Report.create(user_id:current_user.id , item_name:@stock.item_name,value:(price/(@stock.quantity)),<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.item_name 12 times                        <a href="stocks_controller.html#L48" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L67" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity 13 times                        <a href="stocks_controller.html#L56" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L75" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L83" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L88" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">11</a>                  <a href="stocks_controller.html#L141" class="js-smell-location">12</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls current_user.id 11 times                        <a href="stocks_controller.html#L47" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L48" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">10</a>                  </span>  </li></ul>
                              quantity:@stock.quantity)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity 13 times                        <a href="stocks_controller.html#L56" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L75" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L83" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L88" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">11</a>                  <a href="stocks_controller.html#L141" class="js-smell-location">12</a>                  </span>  </li></ul>
                            end

                            if @stock.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Similar code found in 4 nodes                        <a href="masters_controller.html#L32" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L91" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L121" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L143" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.save 3 times                        <a href="stocks_controller.html#L91" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L121" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L143" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(RepeatedConditional) StocksController tests @stock.save at least 3 times                        <a href="stocks_controller.html#L91" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L121" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L143" class="js-smell-location">2</a>                  </span>  </li></ul>
                            format.html { redirect_to @stock, notice: &#39;New Item has been successfully added.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.html 11 times                        <a href="stocks_controller.html#L54" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L57" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L92" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L95" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L100" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L125" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L131" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L147" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L154" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.html do ... end 3 times                        <a href="stocks_controller.html#L92" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls redirect_to(@stock, notice: "New Item has been successfully added.") 3 times                        <a href="stocks_controller.html#L92" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">2</a>                  </span>  </li></ul>
                            format.json { render :show, status: :created, location: @stock }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json 9 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L96" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">8</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json do ... end 5 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">4</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls render(:show, status: :created, location: @stock) 5 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">4</a>                  </span>  </li></ul>
                            else
                              format.html { render :new }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.html 11 times                        <a href="stocks_controller.html#L54" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L57" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L92" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L95" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L100" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L125" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L131" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L147" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L154" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls render(:new) 3 times                        <a href="stocks_controller.html#L95" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L125" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L147" class="js-smell-location">2</a>                  </span>  </li></ul>
                              format.json { render json: @stock.errors, status: :unprocessable_entity }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.errors 4 times                        <a href="stocks_controller.html#L96" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json 9 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L96" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">8</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json do ... end 4 times                        <a href="stocks_controller.html#L96" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls render(json: @stock.errors, status: :unprocessable_entity) 4 times                        <a href="stocks_controller.html#L96" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">3</a>                  </span>  </li></ul>
                            end

                        else
                            format.html { redirect_to @stock, notice: &#39;Item from masters list is only allowed with base unit_of_measure(level=1)&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.html 11 times                        <a href="stocks_controller.html#L54" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L57" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L92" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L95" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L100" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L125" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L131" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L147" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L154" class="js-smell-location">10</a>                  </span>  </li></ul>
                            format.json { render :show, status: :created, location: @stock }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json 9 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L96" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">8</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json do ... end 5 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">4</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls render(:show, status: :created, location: @stock) 5 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">4</a>                  </span>  </li></ul>
                        end

                    else
                        #  is personal item present in stock
                        if @item.present?
                            # only 1 uom is allowed for personal item
                            if @uom.present?
                                # find average value of product
                                report = Report.find_by(item_name: @stock.item_name , user_id: current_user.id)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.item_name 12 times                        <a href="stocks_controller.html#L48" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L67" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls Report.find_by(item_name: @stock.item_name, user_id: current_user.id) 2 times                        <a href="stocks_controller.html#L81" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls current_user.id 11 times                        <a href="stocks_controller.html#L47" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L48" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">10</a>                  </span>  </li></ul>
                                price = @stock.quantity*report.value<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity 13 times                        <a href="stocks_controller.html#L56" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L75" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L83" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L88" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">11</a>                  <a href="stocks_controller.html#L141" class="js-smell-location">12</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.value 3 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">2</a>                  </span>  </li></ul>

                                purchase=Purchase.create(user_id: current_user.id , wholesaler: &quot;Stock Correction&quot;,item_name: @stock.item_name ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.item_name 12 times                        <a href="stocks_controller.html#L48" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L67" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls current_user.id 11 times                        <a href="stocks_controller.html#L47" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L48" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">10</a>                  </span>  </li></ul>
                                batch_number: @stock.batch_number ,unit_of_measure: @stock.unit_of_measure ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.batch_number 4 times                        <a href="stocks_controller.html#L50" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L77" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L114" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L137" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.unit_of_measure 6 times                        <a href="stocks_controller.html#L49" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L74" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L114" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L137" class="js-smell-location">5</a>                  </span>  </li></ul>
                                expiry_date: @stock.expiry_date , quantity:@stock.quantity , date_of_purchase: time , total_price:price)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.expiry_date 4 times                        <a href="stocks_controller.html#L53" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity 13 times                        <a href="stocks_controller.html#L56" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L75" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L83" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L88" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">11</a>                  <a href="stocks_controller.html#L141" class="js-smell-location">12</a>                  </span>  </li></ul>

                                report.value = (price + report.value*report.quantity)/(@stock.quantity + report.quantity)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls (price + (report.value * report.quantity)) / (@stock.quantity + report.quantity) 2 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity + report.quantity 2 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity 13 times                        <a href="stocks_controller.html#L56" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L75" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L83" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L88" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">11</a>                  <a href="stocks_controller.html#L141" class="js-smell-location">12</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls price + (report.value * report.quantity) 2 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.quantity 6 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.value * report.quantity 2 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.value 3 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.value = ((price + (report.value * report.quantity)) / (@stock.quantity + report.quantity)) 2 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">1</a>                  </span>  </li></ul>
                                report.quantity = report.quantity + @stock.quantity<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity 13 times                        <a href="stocks_controller.html#L56" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L75" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L83" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L88" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">11</a>                  <a href="stocks_controller.html#L141" class="js-smell-location">12</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.quantity + @stock.quantity 2 times                        <a href="stocks_controller.html#L84" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.quantity 6 times                        <a href="stocks_controller.html#L83" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.quantity = (report.quantity + @stock.quantity) 2 times                        <a href="stocks_controller.html#L84" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">1</a>                  </span>  </li></ul>
                                report.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls report.save 2 times                        <a href="stocks_controller.html#L85" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L119" class="js-smell-location">1</a>                  </span>  </li></ul>

                                if @stock.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Similar code found in 4 nodes                        <a href="masters_controller.html#L32" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L91" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L121" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L143" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.save 3 times                        <a href="stocks_controller.html#L91" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L121" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L143" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(RepeatedConditional) StocksController tests @stock.save at least 3 times                        <a href="stocks_controller.html#L91" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L121" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L143" class="js-smell-location">2</a>                  </span>  </li></ul>
                                format.html { redirect_to @stock, notice: &#39;New Item has been successfully added.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.html 11 times                        <a href="stocks_controller.html#L54" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L57" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L92" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L95" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L100" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L125" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L131" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L147" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L154" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.html do ... end 3 times                        <a href="stocks_controller.html#L92" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls redirect_to(@stock, notice: "New Item has been successfully added.") 3 times                        <a href="stocks_controller.html#L92" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">2</a>                  </span>  </li></ul>
                                format.json { render :show, status: :created, location: @stock }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json 9 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L96" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">8</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json do ... end 5 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">4</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls render(:show, status: :created, location: @stock) 5 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">4</a>                  </span>  </li></ul>
                                else
                                  format.html { render :new }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.html 11 times                        <a href="stocks_controller.html#L54" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L57" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L92" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L95" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L100" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L125" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L131" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L147" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L154" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls render(:new) 3 times                        <a href="stocks_controller.html#L95" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L125" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L147" class="js-smell-location">2</a>                  </span>  </li></ul>
                                  format.json { render json: @stock.errors, status: :unprocessable_entity }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.errors 4 times                        <a href="stocks_controller.html#L96" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json 9 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L96" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">8</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json do ... end 4 times                        <a href="stocks_controller.html#L96" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls render(json: @stock.errors, status: :unprocessable_entity) 4 times                        <a href="stocks_controller.html#L96" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">3</a>                  </span>  </li></ul>
                                end

                            else
                                #  as defined Personal item with only one unit_of_measure is allowed
                                format.html { redirect_to @stock, notice: &#39;Personal item with only one unit_of_measure is allowed&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.html 11 times                        <a href="stocks_controller.html#L54" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L57" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L92" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L95" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L100" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L125" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L131" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L147" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L154" class="js-smell-location">10</a>                  </span>  </li></ul>
                                format.json { render :show, status: :created, location: @stock }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json 9 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L96" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">8</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json do ... end 5 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">4</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls render(:show, status: :created, location: @stock) 5 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">4</a>                  </span>  </li></ul>
                            end

                        else
                            purchase=Purchase.create(user_id: current_user.id , wholesaler: &quot;Stock Correction&quot;,item_name: @stock.item_name ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.item_name 12 times                        <a href="stocks_controller.html#L48" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L67" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls current_user.id 11 times                        <a href="stocks_controller.html#L47" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L48" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">10</a>                  </span>  </li></ul>
                            batch_number: @stock.batch_number ,unit_of_measure: @stock.unit_of_measure ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.batch_number 4 times                        <a href="stocks_controller.html#L50" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L77" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L114" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L137" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.unit_of_measure 6 times                        <a href="stocks_controller.html#L49" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L74" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L114" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L137" class="js-smell-location">5</a>                  </span>  </li></ul>
                            expiry_date: @stock.expiry_date , quantity:@stock.quantity , date_of_purchase: time , total_price:0)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.expiry_date 4 times                        <a href="stocks_controller.html#L53" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity 13 times                        <a href="stocks_controller.html#L56" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L75" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L83" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L88" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">11</a>                  <a href="stocks_controller.html#L141" class="js-smell-location">12</a>                  </span>  </li></ul>

                            report=Report.create(user_id:current_user.id , item_name:@stock.item_name,value:0,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.item_name 12 times                        <a href="stocks_controller.html#L48" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L62" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L67" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls current_user.id 11 times                        <a href="stocks_controller.html#L47" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L48" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L49" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L50" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L76" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L81" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L110" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L113" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L136" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L140" class="js-smell-location">10</a>                  </span>  </li></ul>
                            quantity:@stock.quantity)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.quantity 13 times                        <a href="stocks_controller.html#L56" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L75" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L78" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L83" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L84" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L87" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L88" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L111" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L115" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L117" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L118" class="js-smell-location">10</a>                  <a href="stocks_controller.html#L138" class="js-smell-location">11</a>                  <a href="stocks_controller.html#L141" class="js-smell-location">12</a>                  </span>  </li></ul>

                            if @stock.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Similar code found in 4 nodes                        <a href="masters_controller.html#L32" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L91" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L121" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L143" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.save 3 times                        <a href="stocks_controller.html#L91" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L121" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L143" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(RepeatedConditional) StocksController tests @stock.save at least 3 times                        <a href="stocks_controller.html#L91" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L121" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L143" class="js-smell-location">2</a>                  </span>  </li></ul>
                            format.html { redirect_to @stock, notice: &#39;New Item has been successfully added.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.html 11 times                        <a href="stocks_controller.html#L54" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L57" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L92" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L95" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L100" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L125" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L131" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L147" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L154" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.html do ... end 3 times                        <a href="stocks_controller.html#L92" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls redirect_to(@stock, notice: "New Item has been successfully added.") 3 times                        <a href="stocks_controller.html#L92" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">2</a>                  </span>  </li></ul>
                            format.json { render :show, status: :created, location: @stock }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json 9 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L96" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">8</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json do ... end 5 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">4</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls render(:show, status: :created, location: @stock) 5 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">4</a>                  </span>  </li></ul>
                            else
                              format.html { render :new }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.html 11 times                        <a href="stocks_controller.html#L54" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L57" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L92" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L95" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L100" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L125" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L131" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L147" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L154" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls render(:new) 3 times                        <a href="stocks_controller.html#L95" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L125" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L147" class="js-smell-location">2</a>                  </span>  </li></ul>
                              format.json { render json: @stock.errors, status: :unprocessable_entity }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.errors 4 times                        <a href="stocks_controller.html#L96" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json 9 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L96" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">8</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json do ... end 4 times                        <a href="stocks_controller.html#L96" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls render(json: @stock.errors, status: :unprocessable_entity) 4 times                        <a href="stocks_controller.html#L96" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">3</a>                  </span>  </li></ul>
                            end

                        end
                    end
            else
                format.html { redirect_to @stock, notice: &#39;Item with corresponding unit_of_measure and batch number already exist.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.html 11 times                        <a href="stocks_controller.html#L54" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L57" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L92" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L95" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L100" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L122" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L125" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L131" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L144" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L147" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L154" class="js-smell-location">10</a>                  </span>  </li></ul>
                format.json { render json: @stock.errors, status: :unprocessable_entity }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls @stock.errors 4 times                        <a href="stocks_controller.html#L96" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json 9 times                        <a href="stocks_controller.html#L93" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L96" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L101" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L123" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L132" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L145" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">8</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls format.json do ... end 4 times                        <a href="stocks_controller.html#L96" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#create calls render(json: @stock.errors, status: :unprocessable_entity) 4 times                        <a href="stocks_controller.html#L96" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L126" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L148" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L155" class="js-smell-location">3</a>                  </span>  </li></ul>
            end
        end
    end
  end

  # PATCH/PUT /stocks/1
  # PATCH/PUT /stocks/1.json
  def update<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Similar code found in 4 nodes                        <a href="masters_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L191" class="js-smell-location">1</a>                  <a href="sales_controller.html#L180" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L163" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(TooManyStatements) StocksController#update has approx 9 statements          </span>  </li></ul>
    respond_to do |format|
      if @stock.update(stock_params)
        format.html { redirect_to @stock, notice: &#39;Stock was successfully updated.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#update calls format.html 2 times                        <a href="stocks_controller.html#L166" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L169" class="js-smell-location">1</a>                  </span>  </li></ul>
        format.json { render :show, status: :ok, location: @stock }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#update calls format.json 2 times                        <a href="stocks_controller.html#L167" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L170" class="js-smell-location">1</a>                  </span>  </li></ul>
      else
        format.html { render :edit }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#update calls format.html 2 times                        <a href="stocks_controller.html#L166" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L169" class="js-smell-location">1</a>                  </span>  </li></ul>
        format.json { render json: @stock.errors, status: :unprocessable_entity }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#update calls format.json 2 times                        <a href="stocks_controller.html#L167" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L170" class="js-smell-location">1</a>                  </span>  </li></ul>
      end
    end
  end

  # DELETE /stocks/1
  # DELETE /stocks/1.json
  def destroy<ul class="nocode smells js-smells">  <li class="smell new">    <span class="description">(DuplicateCode) Similar code found in 3 nodes                        <a href="purchases_controller.html#L207" class="js-smell-location">0</a>                  <a href="sales_controller.html#L194" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L177" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(TooManyStatements) StocksController#destroy has approx 6 statements          </span>  </li></ul>
    @stock.destroy
    respond_to do |format|
      format.html { redirect_to stocks_url, notice: &#39;Stock was successfully destroyed.&#39; }
      format.json { head :no_content }
    end
  end

  def report<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(HighComplexity) StocksController#report has a flog score of 31          </span>  </li>  <li class="smell old">    <span class="description">(TooManyStatements) StocksController#report has approx 7 statements          </span>  </li></ul>

    if params[:q].present?<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#report calls params[:q] 3 times                        <a href="stocks_controller.html#L187" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L189" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L192" class="js-smell-location">2</a>                  </span>  </li></ul>
      @stocks = Stock.where(&quot;user_id = ?&quot; ,  current_user.id)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#report calls current_user.id 2 times                        <a href="stocks_controller.html#L188" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L191" class="js-smell-location">1</a>                  </span>  </li></ul>
      @stocks = @stocks.where(&quot;item_name = ?&quot; ,params[:q]).all<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#report calls params[:q] 3 times                        <a href="stocks_controller.html#L187" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L189" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L192" class="js-smell-location">2</a>                  </span>  </li></ul>
      if @stocks.present?
        @average = Report.where(&quot;user_id = ?&quot; ,  current_user.id)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#report calls current_user.id 2 times                        <a href="stocks_controller.html#L188" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L191" class="js-smell-location">1</a>                  </span>  </li></ul>
        @average = @average.where(&quot;item_name = ?&quot; , params[:q])<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#report calls params[:q] 3 times                        <a href="stocks_controller.html#L187" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L189" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L192" class="js-smell-location">2</a>                  </span>  </li></ul>
      else
        respond_to do |format|
          format.html { redirect_to report_stocks_path, notice: &quot;Sorry given item doesn&#39;t exist .&quot; }
        end
      end
    end
  end

  def correct<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(VeryHighComplexity) StocksController#correct has a flog score of 369          </span>  </li>  <li class="smell old">    <span class="description">(TooManyStatements) StocksController#correct has approx 35 statements          </span>  </li></ul>
      @stocks = Stock.where(&quot;user_id = ?&quot; ,  current_user.id).ids<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls current_user.id 8 times                        <a href="stocks_controller.html#L202" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L217" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">7</a>                  </span>  </li></ul>
    #    counter_flag to check wheather stock has been updated or not
      $count = 0

        # params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name] = params[:@stocks][:stock][:id(in stock table)][:item_name]
        # [:&quot;#{$i}&quot;] == [:id(in stock table)]
        # params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name] = current quantity send by url
        # &quot;#{$i}&quot; method is used to use variable inside params field
        for $i in @stocks
          if params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name].present?<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li></ul>
              $time = Time.now.strftime(&quot;%Y-%m-%d&quot;)

              # find the requires row in Stock db
              data = Stock.find(&quot;#{$i}&quot;)
              # find the average value of product
              $value = Report.find_by(item_name: data.item_name , user_id: current_user.id)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls Report.find_by(item_name: data.item_name, user_id: current_user.id) 2 times                        <a href="stocks_controller.html#L217" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls current_user.id 8 times                        <a href="stocks_controller.html#L202" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L217" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.item_name 7 times                        <a href="stocks_controller.html#L217" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">6</a>                  </span>  </li></ul>
              $value = $value.value
              # condition to choose weather to make sale or purchase

              if data.quantity &gt; params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name].to_f     #   new sale is created<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.quantity 11 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 13 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">9</a>                  </span>  </li></ul>
                  # .to_f function changes a string to integer
                  $count+=1
                #   new sale is created
                  stock=Sale.create(customer:&quot;Stock Correction&quot;,user_id: current_user.id , item_name: data.item_name ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls current_user.id 8 times                        <a href="stocks_controller.html#L202" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L217" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.item_name 7 times                        <a href="stocks_controller.html#L217" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">6</a>                  </span>  </li></ul>
                  batch_number: data.batch_number ,unit_of_measure: data.unit_of_measure ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.batch_number 2 times                        <a href="stocks_controller.html#L226" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L262" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.unit_of_measure 2 times                        <a href="stocks_controller.html#L226" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L262" class="js-smell-location">1</a>                  </span>  </li></ul>
                  expiry_date: data.expiry_date , quantity:(data.quantity - params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name].to_f),date_of_purchase:&quot;#{$time}&quot;,total_price:$value*(data.quantity - params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name].to_f))<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.expiry_date 2 times                        <a href="stocks_controller.html#L227" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.quantity - params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 4 times                        <a href="stocks_controller.html#L227" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.quantity 11 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 13 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">9</a>                  </span>  </li></ul>

                #   handling total sold in Order table
                  order = Order.find_by(item_name:data.item_name , user_id:current_user.id)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls Order.find_by(item_name: data.item_name, user_id: current_user.id) 2 times                        <a href="stocks_controller.html#L230" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls current_user.id 8 times                        <a href="stocks_controller.html#L202" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L217" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.item_name 7 times                        <a href="stocks_controller.html#L217" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">6</a>                  </span>  </li></ul>

                  if order.present?<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls order.present? 2 times                        <a href="stocks_controller.html#L232" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L248" class="js-smell-location">1</a>                  </span>  </li></ul>
                      order.sold = order.sold + (data.quantity - params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name].to_f )<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.quantity - params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 4 times                        <a href="stocks_controller.html#L227" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.quantity 11 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 13 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">9</a>                  </span>  </li></ul>
                      if order.last &lt; Date.parse($time)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls Date.parse($time) 2 times                        <a href="stocks_controller.html#L234" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L237" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls order.last 3 times                        <a href="stocks_controller.html#L234" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L248" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L249" class="js-smell-location">2</a>                  </span>  </li></ul>
                          order.last = &quot;#{$time}&quot;
                      end
                      if order.first &gt; Date.parse($time)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls Date.parse($time) 2 times                        <a href="stocks_controller.html#L234" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L237" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls order.first 3 times                        <a href="stocks_controller.html#L237" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L248" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L250" class="js-smell-location">2</a>                  </span>  </li></ul>
                          order.first = &quot;#{$time}&quot;
                      end
                      order.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls order.save 2 times                        <a href="stocks_controller.html#L240" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L252" class="js-smell-location">1</a>                  </span>  </li></ul>
                  else
                      order = Order.create(user_id:current_user.id , item_name:data.item_name,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls current_user.id 8 times                        <a href="stocks_controller.html#L202" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L217" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.item_name 7 times                        <a href="stocks_controller.html#L217" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">6</a>                  </span>  </li></ul>
                      sold:(data.quantity - params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name].to_f ).to_f,first:&quot;#{$time}&quot;,last:&quot;#{$time}&quot;)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.quantity - params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 4 times                        <a href="stocks_controller.html#L227" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.quantity 11 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 13 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">9</a>                  </span>  </li></ul>
                  end

                #   in case when there is some conflicts between stock correction and manual feeding
                  order = Order.find_by(item_name: data.item_name , user_id: current_user.id)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls Order.find_by(item_name: data.item_name, user_id: current_user.id) 2 times                        <a href="stocks_controller.html#L230" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls current_user.id 8 times                        <a href="stocks_controller.html#L202" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L217" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.item_name 7 times                        <a href="stocks_controller.html#L217" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">6</a>                  </span>  </li></ul>
                  if order.present? and order.last &lt; order.first<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls order.first 3 times                        <a href="stocks_controller.html#L237" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L248" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L250" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls order.last 3 times                        <a href="stocks_controller.html#L234" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L248" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L249" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls order.present? 2 times                        <a href="stocks_controller.html#L232" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L248" class="js-smell-location">1</a>                  </span>  </li></ul>
                      temp= order.last<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Identical code found in 3 nodes                        <a href="sales_controller.html#L106" class="js-smell-location">0</a>                  <a href="sales_controller.html#L160" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L249" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls order.last 3 times                        <a href="stocks_controller.html#L234" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L248" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L249" class="js-smell-location">2</a>                  </span>  </li></ul>
                      order.last = order.first<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls order.first 3 times                        <a href="stocks_controller.html#L237" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L248" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L250" class="js-smell-location">2</a>                  </span>  </li></ul>
                      order.first = temp
                      order.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls order.save 2 times                        <a href="stocks_controller.html#L240" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L252" class="js-smell-location">1</a>                  </span>  </li></ul>
                  end

                  data.quantity= params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name].to_f<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.quantity = params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 2 times                        <a href="stocks_controller.html#L255" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 13 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">9</a>                  </span>  </li></ul>
                  data.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.save 2 times                        <a href="stocks_controller.html#L256" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L273" class="js-smell-location">1</a>                  </span>  </li></ul>

              elsif data.quantity &lt; params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name].to_f<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.quantity 11 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 13 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">9</a>                  </span>  </li></ul>
                  $count+=1
                #    new purchase created
                  stock=Purchase.create(wholesaler:&quot;Stock Correction&quot;,user_id: current_user.id , item_name: data.item_name ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls current_user.id 8 times                        <a href="stocks_controller.html#L202" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L217" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.item_name 7 times                        <a href="stocks_controller.html#L217" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">6</a>                  </span>  </li></ul>
                  batch_number: data.batch_number ,unit_of_measure: data.unit_of_measure ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.batch_number 2 times                        <a href="stocks_controller.html#L226" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L262" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.unit_of_measure 2 times                        <a href="stocks_controller.html#L226" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L262" class="js-smell-location">1</a>                  </span>  </li></ul>
                  expiry_date: data.expiry_date , quantity:(params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name].to_f - data.quantity ),date_of_purchase:&quot;#{$time}&quot; , total_price: $value*(params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name].to_f - data.quantity))<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Identical code found in 2 nodes                        <a href="stocks_controller.html#L263" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls $value * (params[:@stocks][:stock][:"#{$i}"][:item_name].to_f - data.quantity) 2 times                        <a href="stocks_controller.html#L263" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.expiry_date 2 times                        <a href="stocks_controller.html#L227" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.quantity 11 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name].to_f - data.quantity 5 times                        <a href="stocks_controller.html#L263" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 13 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">9</a>                  </span>  </li></ul>


                    #   update report
                    report = Report.find_by(item_name: data.item_name , user_id: current_user.id)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls Report.find_by(item_name: data.item_name, user_id: current_user.id) 2 times                        <a href="stocks_controller.html#L217" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls current_user.id 8 times                        <a href="stocks_controller.html#L202" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L217" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.item_name 7 times                        <a href="stocks_controller.html#L217" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L225" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L230" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L242" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L247" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L261" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L267" class="js-smell-location">6</a>                  </span>  </li></ul>
                    report.value = ($value*(params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name].to_f - data.quantity) + report.value*report.quantity)/((params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name].to_f - data.quantity ) + report.quantity)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Identical code found in 2 nodes                        <a href="stocks_controller.html#L263" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls $value * (params[:@stocks][:stock][:"#{$i}"][:item_name].to_f - data.quantity) 2 times                        <a href="stocks_controller.html#L263" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.quantity 11 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name].to_f - data.quantity 5 times                        <a href="stocks_controller.html#L263" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 13 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">9</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls report.quantity 3 times                        <a href="stocks_controller.html#L268" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">1</a>                  </span>  </li></ul>
                    report.quantity = report.quantity + (params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name].to_f - data.quantity )<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.quantity 11 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name].to_f - data.quantity 5 times                        <a href="stocks_controller.html#L263" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 13 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">9</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls report.quantity 3 times                        <a href="stocks_controller.html#L268" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">1</a>                  </span>  </li></ul>
                    report.save

                  data.quantity= params[:@stocks][:stock][:&quot;#{$i}&quot;][:item_name].to_f<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.quantity = params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 2 times                        <a href="stocks_controller.html#L255" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name] 14 times                        <a href="stocks_controller.html#L211" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L221" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">9</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">10</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls params[:@stocks][:stock][:"#{$i}"][:item_name].to_f 13 times                        <a href="stocks_controller.html#L221" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L227" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L233" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L243" class="js-smell-location">3</a>                  <a href="stocks_controller.html#L255" class="js-smell-location">4</a>                  <a href="stocks_controller.html#L258" class="js-smell-location">5</a>                  <a href="stocks_controller.html#L263" class="js-smell-location">6</a>                  <a href="stocks_controller.html#L268" class="js-smell-location">7</a>                  <a href="stocks_controller.html#L269" class="js-smell-location">8</a>                  <a href="stocks_controller.html#L272" class="js-smell-location">9</a>                  </span>  </li></ul>
                  data.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls data.save 2 times                        <a href="stocks_controller.html#L256" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L273" class="js-smell-location">1</a>                  </span>  </li></ul>

              end

          end
       end
        if $count&gt;0
          respond_to do |format|
              format.html { redirect_to stocks_path, notice: &quot;Stock has been updated .&quot; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls format.html 2 times                        <a href="stocks_controller.html#L281" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L285" class="js-smell-location">1</a>                  </span>  </li></ul>
          end
        else
            respond_to do |format|
                format.html { redirect_to stocks_path, notice: &quot;No change in stocks .&quot; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) StocksController#correct calls format.html 2 times                        <a href="stocks_controller.html#L281" class="js-smell-location">0</a>                  <a href="stocks_controller.html#L285" class="js-smell-location">1</a>                  </span>  </li></ul>
            end
        end

  end

  private
    # Use callbacks to share common setup or constraints between actions.
    def set_stock<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(UnusedPrivateMethod) StocksController has the unused private instance method `set_stock`          </span>  </li></ul>
      @stock = Stock.where(&quot;user_id = ?&quot; ,  current_user.id).find(params[:id])
    end

    # Never trust parameters from the scary internet, only allow the white list through.
    def stock_params
      params.require(:stock).permit(:item_name, :unit_of_measure, :batch_number, :quantity, :expiry_date)
    end

end
</code>

    </div>
    <script src='../../assets/javascripts/jquery-2.1.0.js'></script>
    <script src='../../assets/javascripts/jquery.tablesorter.js'></script>
    <script src='../../assets/javascripts/jquery.floatThead-v1.2.7.js'></script>
    <script src='../../assets/javascripts/jquery.timeago-v1.4.1.js'></script>
    <script src='../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../assets/javascripts/jquery.scrollTo-1.4.11.js'></script>
    <script src='../../assets/javascripts/prettify-4-Mar-2013.js'></script>
    <script src='../../assets/javascripts/application.js'></script>
  </body>
</html>
