<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>RubyCritic</title>
    <link href="../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <header class="project-header group">
      <div class="container">
        <h1 class="logo"><a href="../../overview.html" class="logo-link">RubyCritic</a></h1>
        <nav class="project-nav">
          <a href="../../overview.html" class="project-nav-item">Overview</a>
          <a href="../../code_index.html" class="project-nav-item">Code</a>
          <a href="../../smells_index.html" class="project-nav-item">Smells</a>
        </nav>
      </div>
    </header>
    <div class="container">
      <div class="file-header group rated">
  <span class="rating rating-f circled-text circle">
    F
  </span>
  <h2 class="file-name">SalesController</h2>

  <span class="file-committed-at">
    
      Updated <time class='js-timeago' datetime='2015-11-19 20:52:06 +0530'>2015-11-19 20:52:06 +0530</time>
    
  </span>

  <div class="file-stats group">
    <div class="file-stat">
      403 complexity
    </div>
    <div class="file-stat">
      40.3 complexity per method
    </div>
    <div class="file-stat">
      16 churn
    </div>
    <div class="file-stat">
      10 methods
    </div>
    <div class="file-stat">
      136 duplication
    </div>
  </div>

  
    <button id="js-toggle-smells" class="smells-toggle-button button">Toggle Smells</button>
  
</div>

<code class="prettyprint linenums lang-ruby file-code js-file-code">class SalesController &lt; ApplicationController<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(IrresponsibleModule) SalesController has no descriptive comment          </span>  </li></ul>
  before_action :authenticate_user!
  # authenticated to use only show method , i.e it can;t be updated , edit or  destroy
  before_action :set_sale, only: [:show]

  # GET /sales
  # GET /sales.json
  def index
    @sales = Sale.where(&quot;user_id = ?&quot; ,  current_user.id)

  end

  # GET /sales/1
  # GET /sales/1.json
  def show
  end

  # GET /sales/new
  def new
    @sale = Sale.new
  end

  # GET /sales/1/edit
  def edit
  end

  # POST /sales
  # POST /sales.json

# send all name of customer in form of json
  def customer
      @customer = Sale.where(&quot;user_id = ?&quot; ,  current_user.id).distinct.pluck(:customer)
      render json: @customer
  end

  def create<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(VeryHighComplexity) SalesController#create has a flog score of 351          </span>  </li>  <li class="smell old">    <span class="description">(TooManyStatements) SalesController#create has approx 64 statements          </span>  </li></ul>
    @sale = Sale.new(sale_params)
    @sale.user_id = current_user.id<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls current_user.id 11 times                        <a href="sales_controller.html#L38" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L87" class="js-smell-location">2</a>                  <a href="sales_controller.html#L99" class="js-smell-location">3</a>                  <a href="sales_controller.html#L104" class="js-smell-location">4</a>                  <a href="sales_controller.html#L120" class="js-smell-location">5</a>                  <a href="sales_controller.html#L121" class="js-smell-location">6</a>                  <a href="sales_controller.html#L132" class="js-smell-location">7</a>                  <a href="sales_controller.html#L141" class="js-smell-location">8</a>                  <a href="sales_controller.html#L153" class="js-smell-location">9</a>                  <a href="sales_controller.html#L158" class="js-smell-location">10</a>                  </span>  </li></ul>

    #Now various validations
    respond_to do |format|
     if @sale.quantity&lt;=0<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.quantity 8 times                        <a href="sales_controller.html#L42" class="js-smell-location">0</a>                  <a href="sales_controller.html#L75" class="js-smell-location">1</a>                  <a href="sales_controller.html#L83" class="js-smell-location">2</a>                  <a href="sales_controller.html#L90" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L137" class="js-smell-location">5</a>                  <a href="sales_controller.html#L144" class="js-smell-location">6</a>                  <a href="sales_controller.html#L154" class="js-smell-location">7</a>                  </span>  </li></ul>
        format.html { redirect_to @sale, notice: &#39;Given quantity is not acceptable.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.html 8 times                        <a href="sales_controller.html#L43" class="js-smell-location">0</a>                  <a href="sales_controller.html#L50" class="js-smell-location">1</a>                  <a href="sales_controller.html#L64" class="js-smell-location">2</a>                  <a href="sales_controller.html#L79" class="js-smell-location">3</a>                  <a href="sales_controller.html#L111" class="js-smell-location">4</a>                  <a href="sales_controller.html#L126" class="js-smell-location">5</a>                  <a href="sales_controller.html#L129" class="js-smell-location">6</a>                  <a href="sales_controller.html#L166" class="js-smell-location">7</a>                  </span>  </li></ul>

      # as specified retailer can sale product even if item&#39;s quantity is less than required
 #    elsif stock.quantity &lt; @sale.quantity*$total
  #      format.html { redirect_to @sale, notice: &#39;Required quantity is not available in stock&#39; }

     elsif @sale.total_price&lt;=0<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.total_price 2 times                        <a href="sales_controller.html#L49" class="js-smell-location">0</a>                  <a href="sales_controller.html#L78" class="js-smell-location">1</a>                  </span>  </li></ul>
      format.html { redirect_to @sale, notice: &#39;Total price less than zero is not exceptable.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.html 8 times                        <a href="sales_controller.html#L43" class="js-smell-location">0</a>                  <a href="sales_controller.html#L50" class="js-smell-location">1</a>                  <a href="sales_controller.html#L64" class="js-smell-location">2</a>                  <a href="sales_controller.html#L79" class="js-smell-location">3</a>                  <a href="sales_controller.html#L111" class="js-smell-location">4</a>                  <a href="sales_controller.html#L126" class="js-smell-location">5</a>                  <a href="sales_controller.html#L129" class="js-smell-location">6</a>                  <a href="sales_controller.html#L166" class="js-smell-location">7</a>                  </span>  </li></ul>

     else
        #find weather given item and uom matches to master table
        validate = Master.find_by(item_name: @sale.item_name , uom: @sale.unit_of_measure)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.item_name 12 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L71" class="js-smell-location">2</a>                  <a href="sales_controller.html#L87" class="js-smell-location">3</a>                  <a href="sales_controller.html#L99" class="js-smell-location">4</a>                  <a href="sales_controller.html#L104" class="js-smell-location">5</a>                  <a href="sales_controller.html#L120" class="js-smell-location">6</a>                  <a href="sales_controller.html#L121" class="js-smell-location">7</a>                  <a href="sales_controller.html#L132" class="js-smell-location">8</a>                  <a href="sales_controller.html#L141" class="js-smell-location">9</a>                  <a href="sales_controller.html#L153" class="js-smell-location">10</a>                  <a href="sales_controller.html#L158" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.unit_of_measure 3 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L122" class="js-smell-location">1</a>                  <a href="sales_controller.html#L133" class="js-smell-location">2</a>                  </span>  </li></ul>

            #  if item is in masters list
        if validate.present?
            # find the required item in stock
            stock = Stock.find_by(user_id: current_user.id , item_name: @sale.item_name ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.item_name 12 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L71" class="js-smell-location">2</a>                  <a href="sales_controller.html#L87" class="js-smell-location">3</a>                  <a href="sales_controller.html#L99" class="js-smell-location">4</a>                  <a href="sales_controller.html#L104" class="js-smell-location">5</a>                  <a href="sales_controller.html#L120" class="js-smell-location">6</a>                  <a href="sales_controller.html#L121" class="js-smell-location">7</a>                  <a href="sales_controller.html#L132" class="js-smell-location">8</a>                  <a href="sales_controller.html#L141" class="js-smell-location">9</a>                  <a href="sales_controller.html#L153" class="js-smell-location">10</a>                  <a href="sales_controller.html#L158" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls current_user.id 11 times                        <a href="sales_controller.html#L38" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L87" class="js-smell-location">2</a>                  <a href="sales_controller.html#L99" class="js-smell-location">3</a>                  <a href="sales_controller.html#L104" class="js-smell-location">4</a>                  <a href="sales_controller.html#L120" class="js-smell-location">5</a>                  <a href="sales_controller.html#L121" class="js-smell-location">6</a>                  <a href="sales_controller.html#L132" class="js-smell-location">7</a>                  <a href="sales_controller.html#L141" class="js-smell-location">8</a>                  <a href="sales_controller.html#L153" class="js-smell-location">9</a>                  <a href="sales_controller.html#L158" class="js-smell-location">10</a>                  </span>  </li></ul>
                 batch_number: @sale.batch_number )<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.batch_number 2 times                        <a href="sales_controller.html#L60" class="js-smell-location">0</a>                  <a href="sales_controller.html#L133" class="js-smell-location">1</a>                  </span>  </li></ul>

                #   no sale if item is not in stocks &quot;list&quot;
         if !stock.present?
             format.html { redirect_to @sale, notice: &#39;Item is not in stocks&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.html 8 times                        <a href="sales_controller.html#L43" class="js-smell-location">0</a>                  <a href="sales_controller.html#L50" class="js-smell-location">1</a>                  <a href="sales_controller.html#L64" class="js-smell-location">2</a>                  <a href="sales_controller.html#L79" class="js-smell-location">3</a>                  <a href="sales_controller.html#L111" class="js-smell-location">4</a>                  <a href="sales_controller.html#L126" class="js-smell-location">5</a>                  <a href="sales_controller.html#L129" class="js-smell-location">6</a>                  <a href="sales_controller.html#L166" class="js-smell-location">7</a>                  </span>  </li></ul>

         else
              # logic to find least count of quantity
             $i=1
             $total=1
             while $i &lt;= validate.level<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Similar code found in 2 nodes                        <a href="purchases_controller.html#L52" class="js-smell-location">0</a>                  <a href="sales_controller.html#L70" class="js-smell-location">1</a>                  </span>  </li></ul>
              factor = Master.find_by(item_name: @sale.item_name , level: $i)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.item_name 12 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L71" class="js-smell-location">2</a>                  <a href="sales_controller.html#L87" class="js-smell-location">3</a>                  <a href="sales_controller.html#L99" class="js-smell-location">4</a>                  <a href="sales_controller.html#L104" class="js-smell-location">5</a>                  <a href="sales_controller.html#L120" class="js-smell-location">6</a>                  <a href="sales_controller.html#L121" class="js-smell-location">7</a>                  <a href="sales_controller.html#L132" class="js-smell-location">8</a>                  <a href="sales_controller.html#L141" class="js-smell-location">9</a>                  <a href="sales_controller.html#L153" class="js-smell-location">10</a>                  <a href="sales_controller.html#L158" class="js-smell-location">11</a>                  </span>  </li></ul>
              $total *= factor.units*factor.conversion
              $i += 1
             end
             mrp = validate.mrp * @sale.quantity<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.quantity 8 times                        <a href="sales_controller.html#L42" class="js-smell-location">0</a>                  <a href="sales_controller.html#L75" class="js-smell-location">1</a>                  <a href="sales_controller.html#L83" class="js-smell-location">2</a>                  <a href="sales_controller.html#L90" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L137" class="js-smell-location">5</a>                  <a href="sales_controller.html#L144" class="js-smell-location">6</a>                  <a href="sales_controller.html#L154" class="js-smell-location">7</a>                  </span>  </li></ul>

            #  sale cannot be greater than MRP
             if @sale.total_price &gt; mrp<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.total_price 2 times                        <a href="sales_controller.html#L49" class="js-smell-location">0</a>                  <a href="sales_controller.html#L78" class="js-smell-location">1</a>                  </span>  </li></ul>
                 format.html { redirect_to @sale , notice: &#39;Total price cannot be greater than maximium selling price.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.html 8 times                        <a href="sales_controller.html#L43" class="js-smell-location">0</a>                  <a href="sales_controller.html#L50" class="js-smell-location">1</a>                  <a href="sales_controller.html#L64" class="js-smell-location">2</a>                  <a href="sales_controller.html#L79" class="js-smell-location">3</a>                  <a href="sales_controller.html#L111" class="js-smell-location">4</a>                  <a href="sales_controller.html#L126" class="js-smell-location">5</a>                  <a href="sales_controller.html#L129" class="js-smell-location">6</a>                  <a href="sales_controller.html#L166" class="js-smell-location">7</a>                  </span>  </li></ul>

             elsif @sale.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.save 2 times                        <a href="sales_controller.html#L81" class="js-smell-location">0</a>                  <a href="sales_controller.html#L135" class="js-smell-location">1</a>                  </span>  </li></ul>
               # method to update stock if any item got saled
                 stock.quantity = stock.quantity - @sale.quantity*$total<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.quantity * $total 3 times                        <a href="sales_controller.html#L83" class="js-smell-location">0</a>                  <a href="sales_controller.html#L90" class="js-smell-location">1</a>                  <a href="sales_controller.html#L100" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.quantity 8 times                        <a href="sales_controller.html#L42" class="js-smell-location">0</a>                  <a href="sales_controller.html#L75" class="js-smell-location">1</a>                  <a href="sales_controller.html#L83" class="js-smell-location">2</a>                  <a href="sales_controller.html#L90" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L137" class="js-smell-location">5</a>                  <a href="sales_controller.html#L144" class="js-smell-location">6</a>                  <a href="sales_controller.html#L154" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls stock.quantity 2 times                        <a href="sales_controller.html#L83" class="js-smell-location">0</a>                  <a href="sales_controller.html#L137" class="js-smell-location">1</a>                  </span>  </li></ul>
                 stock.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls stock.save 2 times                        <a href="sales_controller.html#L84" class="js-smell-location">0</a>                  <a href="sales_controller.html#L138" class="js-smell-location">1</a>                  </span>  </li></ul>

                 #   handling total sold in Order table
                 order = Order.find_by(item_name: @sale.item_name , user_id: current_user.id)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.item_name 12 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L71" class="js-smell-location">2</a>                  <a href="sales_controller.html#L87" class="js-smell-location">3</a>                  <a href="sales_controller.html#L99" class="js-smell-location">4</a>                  <a href="sales_controller.html#L104" class="js-smell-location">5</a>                  <a href="sales_controller.html#L120" class="js-smell-location">6</a>                  <a href="sales_controller.html#L121" class="js-smell-location">7</a>                  <a href="sales_controller.html#L132" class="js-smell-location">8</a>                  <a href="sales_controller.html#L141" class="js-smell-location">9</a>                  <a href="sales_controller.html#L153" class="js-smell-location">10</a>                  <a href="sales_controller.html#L158" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls Order.find_by(item_name: @sale.item_name, user_id: current_user.id) 4 times                        <a href="sales_controller.html#L87" class="js-smell-location">0</a>                  <a href="sales_controller.html#L104" class="js-smell-location">1</a>                  <a href="sales_controller.html#L141" class="js-smell-location">2</a>                  <a href="sales_controller.html#L158" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls current_user.id 11 times                        <a href="sales_controller.html#L38" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L87" class="js-smell-location">2</a>                  <a href="sales_controller.html#L99" class="js-smell-location">3</a>                  <a href="sales_controller.html#L104" class="js-smell-location">4</a>                  <a href="sales_controller.html#L120" class="js-smell-location">5</a>                  <a href="sales_controller.html#L121" class="js-smell-location">6</a>                  <a href="sales_controller.html#L132" class="js-smell-location">7</a>                  <a href="sales_controller.html#L141" class="js-smell-location">8</a>                  <a href="sales_controller.html#L153" class="js-smell-location">9</a>                  <a href="sales_controller.html#L158" class="js-smell-location">10</a>                  </span>  </li></ul>

                 if order.present?<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.present? 4 times                        <a href="sales_controller.html#L89" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L143" class="js-smell-location">2</a>                  <a href="sales_controller.html#L159" class="js-smell-location">3</a>                  </span>  </li></ul>
                     order.sold = order.sold + (@sale.quantity*$total )<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.quantity * $total 3 times                        <a href="sales_controller.html#L83" class="js-smell-location">0</a>                  <a href="sales_controller.html#L90" class="js-smell-location">1</a>                  <a href="sales_controller.html#L100" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.quantity 8 times                        <a href="sales_controller.html#L42" class="js-smell-location">0</a>                  <a href="sales_controller.html#L75" class="js-smell-location">1</a>                  <a href="sales_controller.html#L83" class="js-smell-location">2</a>                  <a href="sales_controller.html#L90" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L137" class="js-smell-location">5</a>                  <a href="sales_controller.html#L144" class="js-smell-location">6</a>                  <a href="sales_controller.html#L154" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.sold 2 times                        <a href="sales_controller.html#L90" class="js-smell-location">0</a>                  <a href="sales_controller.html#L144" class="js-smell-location">1</a>                  </span>  </li></ul>
                     if order.last &lt; @sale.date_of_purchase<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.date_of_purchase 12 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L92" class="js-smell-location">1</a>                  <a href="sales_controller.html#L94" class="js-smell-location">2</a>                  <a href="sales_controller.html#L95" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L145" class="js-smell-location">5</a>                  <a href="sales_controller.html#L146" class="js-smell-location">6</a>                  <a href="sales_controller.html#L148" class="js-smell-location">7</a>                  <a href="sales_controller.html#L149" class="js-smell-location">8</a>                  <a href="sales_controller.html#L154" class="js-smell-location">9</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.last 6 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L106" class="js-smell-location">2</a>                  <a href="sales_controller.html#L145" class="js-smell-location">3</a>                  <a href="sales_controller.html#L159" class="js-smell-location">4</a>                  <a href="sales_controller.html#L160" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.last < @sale.date_of_purchase 2 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L145" class="js-smell-location">1</a>                  </span>  </li></ul>
                     order.last = @sale.date_of_purchase<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.date_of_purchase 12 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L92" class="js-smell-location">1</a>                  <a href="sales_controller.html#L94" class="js-smell-location">2</a>                  <a href="sales_controller.html#L95" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L145" class="js-smell-location">5</a>                  <a href="sales_controller.html#L146" class="js-smell-location">6</a>                  <a href="sales_controller.html#L148" class="js-smell-location">7</a>                  <a href="sales_controller.html#L149" class="js-smell-location">8</a>                  <a href="sales_controller.html#L154" class="js-smell-location">9</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.last = @sale.date_of_purchase 2 times                        <a href="sales_controller.html#L92" class="js-smell-location">0</a>                  <a href="sales_controller.html#L146" class="js-smell-location">1</a>                  </span>  </li></ul>
                     end
                     if order.first &gt; @sale.date_of_purchase<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.date_of_purchase 12 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L92" class="js-smell-location">1</a>                  <a href="sales_controller.html#L94" class="js-smell-location">2</a>                  <a href="sales_controller.html#L95" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L145" class="js-smell-location">5</a>                  <a href="sales_controller.html#L146" class="js-smell-location">6</a>                  <a href="sales_controller.html#L148" class="js-smell-location">7</a>                  <a href="sales_controller.html#L149" class="js-smell-location">8</a>                  <a href="sales_controller.html#L154" class="js-smell-location">9</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.first 6 times                        <a href="sales_controller.html#L94" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L107" class="js-smell-location">2</a>                  <a href="sales_controller.html#L148" class="js-smell-location">3</a>                  <a href="sales_controller.html#L159" class="js-smell-location">4</a>                  <a href="sales_controller.html#L161" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.first > @sale.date_of_purchase 2 times                        <a href="sales_controller.html#L94" class="js-smell-location">0</a>                  <a href="sales_controller.html#L148" class="js-smell-location">1</a>                  </span>  </li></ul>
                         order.first = @sale.date_of_purchase<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.date_of_purchase 12 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L92" class="js-smell-location">1</a>                  <a href="sales_controller.html#L94" class="js-smell-location">2</a>                  <a href="sales_controller.html#L95" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L145" class="js-smell-location">5</a>                  <a href="sales_controller.html#L146" class="js-smell-location">6</a>                  <a href="sales_controller.html#L148" class="js-smell-location">7</a>                  <a href="sales_controller.html#L149" class="js-smell-location">8</a>                  <a href="sales_controller.html#L154" class="js-smell-location">9</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.first = @sale.date_of_purchase 2 times                        <a href="sales_controller.html#L95" class="js-smell-location">0</a>                  <a href="sales_controller.html#L149" class="js-smell-location">1</a>                  </span>  </li></ul>
                     end
                     order.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.save 4 times                        <a href="sales_controller.html#L97" class="js-smell-location">0</a>                  <a href="sales_controller.html#L109" class="js-smell-location">1</a>                  <a href="sales_controller.html#L151" class="js-smell-location">2</a>                  <a href="sales_controller.html#L163" class="js-smell-location">3</a>                  </span>  </li></ul>
                 else
                     order = Order.create(user_id:current_user.id , item_name:@sale.item_name,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.item_name 12 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L71" class="js-smell-location">2</a>                  <a href="sales_controller.html#L87" class="js-smell-location">3</a>                  <a href="sales_controller.html#L99" class="js-smell-location">4</a>                  <a href="sales_controller.html#L104" class="js-smell-location">5</a>                  <a href="sales_controller.html#L120" class="js-smell-location">6</a>                  <a href="sales_controller.html#L121" class="js-smell-location">7</a>                  <a href="sales_controller.html#L132" class="js-smell-location">8</a>                  <a href="sales_controller.html#L141" class="js-smell-location">9</a>                  <a href="sales_controller.html#L153" class="js-smell-location">10</a>                  <a href="sales_controller.html#L158" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls current_user.id 11 times                        <a href="sales_controller.html#L38" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L87" class="js-smell-location">2</a>                  <a href="sales_controller.html#L99" class="js-smell-location">3</a>                  <a href="sales_controller.html#L104" class="js-smell-location">4</a>                  <a href="sales_controller.html#L120" class="js-smell-location">5</a>                  <a href="sales_controller.html#L121" class="js-smell-location">6</a>                  <a href="sales_controller.html#L132" class="js-smell-location">7</a>                  <a href="sales_controller.html#L141" class="js-smell-location">8</a>                  <a href="sales_controller.html#L153" class="js-smell-location">9</a>                  <a href="sales_controller.html#L158" class="js-smell-location">10</a>                  </span>  </li></ul>
                     sold:@sale.quantity*$total,first:@sale.date_of_purchase,last:@sale.date_of_purchase)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.date_of_purchase 12 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L92" class="js-smell-location">1</a>                  <a href="sales_controller.html#L94" class="js-smell-location">2</a>                  <a href="sales_controller.html#L95" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L145" class="js-smell-location">5</a>                  <a href="sales_controller.html#L146" class="js-smell-location">6</a>                  <a href="sales_controller.html#L148" class="js-smell-location">7</a>                  <a href="sales_controller.html#L149" class="js-smell-location">8</a>                  <a href="sales_controller.html#L154" class="js-smell-location">9</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.quantity * $total 3 times                        <a href="sales_controller.html#L83" class="js-smell-location">0</a>                  <a href="sales_controller.html#L90" class="js-smell-location">1</a>                  <a href="sales_controller.html#L100" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.quantity 8 times                        <a href="sales_controller.html#L42" class="js-smell-location">0</a>                  <a href="sales_controller.html#L75" class="js-smell-location">1</a>                  <a href="sales_controller.html#L83" class="js-smell-location">2</a>                  <a href="sales_controller.html#L90" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L137" class="js-smell-location">5</a>                  <a href="sales_controller.html#L144" class="js-smell-location">6</a>                  <a href="sales_controller.html#L154" class="js-smell-location">7</a>                  </span>  </li></ul>
                 end

                 #   in case when there is some conflicts between stock correction and manual feeding
                 order = Order.find_by(item_name: @sale.item_name , user_id: current_user.id)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.item_name 12 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L71" class="js-smell-location">2</a>                  <a href="sales_controller.html#L87" class="js-smell-location">3</a>                  <a href="sales_controller.html#L99" class="js-smell-location">4</a>                  <a href="sales_controller.html#L104" class="js-smell-location">5</a>                  <a href="sales_controller.html#L120" class="js-smell-location">6</a>                  <a href="sales_controller.html#L121" class="js-smell-location">7</a>                  <a href="sales_controller.html#L132" class="js-smell-location">8</a>                  <a href="sales_controller.html#L141" class="js-smell-location">9</a>                  <a href="sales_controller.html#L153" class="js-smell-location">10</a>                  <a href="sales_controller.html#L158" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls Order.find_by(item_name: @sale.item_name, user_id: current_user.id) 4 times                        <a href="sales_controller.html#L87" class="js-smell-location">0</a>                  <a href="sales_controller.html#L104" class="js-smell-location">1</a>                  <a href="sales_controller.html#L141" class="js-smell-location">2</a>                  <a href="sales_controller.html#L158" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls current_user.id 11 times                        <a href="sales_controller.html#L38" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L87" class="js-smell-location">2</a>                  <a href="sales_controller.html#L99" class="js-smell-location">3</a>                  <a href="sales_controller.html#L104" class="js-smell-location">4</a>                  <a href="sales_controller.html#L120" class="js-smell-location">5</a>                  <a href="sales_controller.html#L121" class="js-smell-location">6</a>                  <a href="sales_controller.html#L132" class="js-smell-location">7</a>                  <a href="sales_controller.html#L141" class="js-smell-location">8</a>                  <a href="sales_controller.html#L153" class="js-smell-location">9</a>                  <a href="sales_controller.html#L158" class="js-smell-location">10</a>                  </span>  </li></ul>
                 if order.present? and order.last &lt; order.first<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.first 6 times                        <a href="sales_controller.html#L94" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L107" class="js-smell-location">2</a>                  <a href="sales_controller.html#L148" class="js-smell-location">3</a>                  <a href="sales_controller.html#L159" class="js-smell-location">4</a>                  <a href="sales_controller.html#L161" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.last 6 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L106" class="js-smell-location">2</a>                  <a href="sales_controller.html#L145" class="js-smell-location">3</a>                  <a href="sales_controller.html#L159" class="js-smell-location">4</a>                  <a href="sales_controller.html#L160" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.last < order.first 2 times                        <a href="sales_controller.html#L105" class="js-smell-location">0</a>                  <a href="sales_controller.html#L159" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.present? 4 times                        <a href="sales_controller.html#L89" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L143" class="js-smell-location">2</a>                  <a href="sales_controller.html#L159" class="js-smell-location">3</a>                  </span>  </li></ul>
                     temp= order.last<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Identical code found in 3 nodes                        <a href="sales_controller.html#L106" class="js-smell-location">0</a>                  <a href="sales_controller.html#L160" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L249" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.last 6 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L106" class="js-smell-location">2</a>                  <a href="sales_controller.html#L145" class="js-smell-location">3</a>                  <a href="sales_controller.html#L159" class="js-smell-location">4</a>                  <a href="sales_controller.html#L160" class="js-smell-location">5</a>                  </span>  </li></ul>
                     order.last = order.first<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.first 6 times                        <a href="sales_controller.html#L94" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L107" class="js-smell-location">2</a>                  <a href="sales_controller.html#L148" class="js-smell-location">3</a>                  <a href="sales_controller.html#L159" class="js-smell-location">4</a>                  <a href="sales_controller.html#L161" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.last = order.first 2 times                        <a href="sales_controller.html#L107" class="js-smell-location">0</a>                  <a href="sales_controller.html#L161" class="js-smell-location">1</a>                  </span>  </li></ul>
                     order.first = temp<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.first = temp 2 times                        <a href="sales_controller.html#L108" class="js-smell-location">0</a>                  <a href="sales_controller.html#L162" class="js-smell-location">1</a>                  </span>  </li></ul>
                     order.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.save 4 times                        <a href="sales_controller.html#L97" class="js-smell-location">0</a>                  <a href="sales_controller.html#L109" class="js-smell-location">1</a>                  <a href="sales_controller.html#L151" class="js-smell-location">2</a>                  <a href="sales_controller.html#L163" class="js-smell-location">3</a>                  </span>  </li></ul>
                 end
               format.html { redirect_to @sale , notice: &#39;Sale was successfully created.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.html 8 times                        <a href="sales_controller.html#L43" class="js-smell-location">0</a>                  <a href="sales_controller.html#L50" class="js-smell-location">1</a>                  <a href="sales_controller.html#L64" class="js-smell-location">2</a>                  <a href="sales_controller.html#L79" class="js-smell-location">3</a>                  <a href="sales_controller.html#L111" class="js-smell-location">4</a>                  <a href="sales_controller.html#L126" class="js-smell-location">5</a>                  <a href="sales_controller.html#L129" class="js-smell-location">6</a>                  <a href="sales_controller.html#L166" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.html do ... end 2 times                        <a href="sales_controller.html#L111" class="js-smell-location">0</a>                  <a href="sales_controller.html#L166" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls redirect_to(@sale, notice: "Sale was successfully created.") 2 times                        <a href="sales_controller.html#L111" class="js-smell-location">0</a>                  <a href="sales_controller.html#L166" class="js-smell-location">1</a>                  </span>  </li></ul>
               format.json { render :show, status: :created, location: @sale }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.json 4 times                        <a href="sales_controller.html#L112" class="js-smell-location">0</a>                  <a href="sales_controller.html#L115" class="js-smell-location">1</a>                  <a href="sales_controller.html#L167" class="js-smell-location">2</a>                  <a href="sales_controller.html#L170" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.json do ... end 2 times                        <a href="sales_controller.html#L112" class="js-smell-location">0</a>                  <a href="sales_controller.html#L167" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls render(:show, status: :created, location: @sale) 2 times                        <a href="sales_controller.html#L112" class="js-smell-location">0</a>                  <a href="sales_controller.html#L167" class="js-smell-location">1</a>                  </span>  </li></ul>

             else
               format.json { render json: @sale.errors, status: :unprocessable_entity }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.errors 2 times                        <a href="sales_controller.html#L115" class="js-smell-location">0</a>                  <a href="sales_controller.html#L170" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.json 4 times                        <a href="sales_controller.html#L112" class="js-smell-location">0</a>                  <a href="sales_controller.html#L115" class="js-smell-location">1</a>                  <a href="sales_controller.html#L167" class="js-smell-location">2</a>                  <a href="sales_controller.html#L170" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls render(json: @sale.errors, status: :unprocessable_entity) 2 times                        <a href="sales_controller.html#L115" class="js-smell-location">0</a>                  <a href="sales_controller.html#L170" class="js-smell-location">1</a>                  </span>  </li></ul>
             end
         end

        else
            stock_item = Stock.find_by(user_id: current_user.id , item_name: @sale.item_name )<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.item_name 12 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L71" class="js-smell-location">2</a>                  <a href="sales_controller.html#L87" class="js-smell-location">3</a>                  <a href="sales_controller.html#L99" class="js-smell-location">4</a>                  <a href="sales_controller.html#L104" class="js-smell-location">5</a>                  <a href="sales_controller.html#L120" class="js-smell-location">6</a>                  <a href="sales_controller.html#L121" class="js-smell-location">7</a>                  <a href="sales_controller.html#L132" class="js-smell-location">8</a>                  <a href="sales_controller.html#L141" class="js-smell-location">9</a>                  <a href="sales_controller.html#L153" class="js-smell-location">10</a>                  <a href="sales_controller.html#L158" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls current_user.id 11 times                        <a href="sales_controller.html#L38" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L87" class="js-smell-location">2</a>                  <a href="sales_controller.html#L99" class="js-smell-location">3</a>                  <a href="sales_controller.html#L104" class="js-smell-location">4</a>                  <a href="sales_controller.html#L120" class="js-smell-location">5</a>                  <a href="sales_controller.html#L121" class="js-smell-location">6</a>                  <a href="sales_controller.html#L132" class="js-smell-location">7</a>                  <a href="sales_controller.html#L141" class="js-smell-location">8</a>                  <a href="sales_controller.html#L153" class="js-smell-location">9</a>                  <a href="sales_controller.html#L158" class="js-smell-location">10</a>                  </span>  </li></ul>
            stock_uom = Stock.find_by(user_id: current_user.id , item_name: @sale.item_name ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.item_name 12 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L71" class="js-smell-location">2</a>                  <a href="sales_controller.html#L87" class="js-smell-location">3</a>                  <a href="sales_controller.html#L99" class="js-smell-location">4</a>                  <a href="sales_controller.html#L104" class="js-smell-location">5</a>                  <a href="sales_controller.html#L120" class="js-smell-location">6</a>                  <a href="sales_controller.html#L121" class="js-smell-location">7</a>                  <a href="sales_controller.html#L132" class="js-smell-location">8</a>                  <a href="sales_controller.html#L141" class="js-smell-location">9</a>                  <a href="sales_controller.html#L153" class="js-smell-location">10</a>                  <a href="sales_controller.html#L158" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls current_user.id 11 times                        <a href="sales_controller.html#L38" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L87" class="js-smell-location">2</a>                  <a href="sales_controller.html#L99" class="js-smell-location">3</a>                  <a href="sales_controller.html#L104" class="js-smell-location">4</a>                  <a href="sales_controller.html#L120" class="js-smell-location">5</a>                  <a href="sales_controller.html#L121" class="js-smell-location">6</a>                  <a href="sales_controller.html#L132" class="js-smell-location">7</a>                  <a href="sales_controller.html#L141" class="js-smell-location">8</a>                  <a href="sales_controller.html#L153" class="js-smell-location">9</a>                  <a href="sales_controller.html#L158" class="js-smell-location">10</a>                  </span>  </li></ul>
                  unit_of_measure:@sale.unit_of_measure)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.unit_of_measure 3 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L122" class="js-smell-location">1</a>                  <a href="sales_controller.html#L133" class="js-smell-location">2</a>                  </span>  </li></ul>

                #   all possible cases when item saled is from personal list
            if !stock_item.present?<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls stock_item.present? 2 times                        <a href="sales_controller.html#L125" class="js-smell-location">0</a>                  <a href="sales_controller.html#L128" class="js-smell-location">1</a>                  </span>  </li></ul>
                format.html { redirect_to @sale, notice: &#39;Item is not in stocks list&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.html 8 times                        <a href="sales_controller.html#L43" class="js-smell-location">0</a>                  <a href="sales_controller.html#L50" class="js-smell-location">1</a>                  <a href="sales_controller.html#L64" class="js-smell-location">2</a>                  <a href="sales_controller.html#L79" class="js-smell-location">3</a>                  <a href="sales_controller.html#L111" class="js-smell-location">4</a>                  <a href="sales_controller.html#L126" class="js-smell-location">5</a>                  <a href="sales_controller.html#L129" class="js-smell-location">6</a>                  <a href="sales_controller.html#L166" class="js-smell-location">7</a>                  </span>  </li></ul>

            elsif stock_item.present? and !stock_uom.present?<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls stock_item.present? 2 times                        <a href="sales_controller.html#L125" class="js-smell-location">0</a>                  <a href="sales_controller.html#L128" class="js-smell-location">1</a>                  </span>  </li></ul>
                 format.html { redirect_to @sale, notice: &#39;Only one uom is allowed for personal items.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.html 8 times                        <a href="sales_controller.html#L43" class="js-smell-location">0</a>                  <a href="sales_controller.html#L50" class="js-smell-location">1</a>                  <a href="sales_controller.html#L64" class="js-smell-location">2</a>                  <a href="sales_controller.html#L79" class="js-smell-location">3</a>                  <a href="sales_controller.html#L111" class="js-smell-location">4</a>                  <a href="sales_controller.html#L126" class="js-smell-location">5</a>                  <a href="sales_controller.html#L129" class="js-smell-location">6</a>                  <a href="sales_controller.html#L166" class="js-smell-location">7</a>                  </span>  </li></ul>

            else
                stock = Stock.find_by(user_id: current_user.id , item_name: @sale.item_name ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.item_name 12 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L71" class="js-smell-location">2</a>                  <a href="sales_controller.html#L87" class="js-smell-location">3</a>                  <a href="sales_controller.html#L99" class="js-smell-location">4</a>                  <a href="sales_controller.html#L104" class="js-smell-location">5</a>                  <a href="sales_controller.html#L120" class="js-smell-location">6</a>                  <a href="sales_controller.html#L121" class="js-smell-location">7</a>                  <a href="sales_controller.html#L132" class="js-smell-location">8</a>                  <a href="sales_controller.html#L141" class="js-smell-location">9</a>                  <a href="sales_controller.html#L153" class="js-smell-location">10</a>                  <a href="sales_controller.html#L158" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls current_user.id 11 times                        <a href="sales_controller.html#L38" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L87" class="js-smell-location">2</a>                  <a href="sales_controller.html#L99" class="js-smell-location">3</a>                  <a href="sales_controller.html#L104" class="js-smell-location">4</a>                  <a href="sales_controller.html#L120" class="js-smell-location">5</a>                  <a href="sales_controller.html#L121" class="js-smell-location">6</a>                  <a href="sales_controller.html#L132" class="js-smell-location">7</a>                  <a href="sales_controller.html#L141" class="js-smell-location">8</a>                  <a href="sales_controller.html#L153" class="js-smell-location">9</a>                  <a href="sales_controller.html#L158" class="js-smell-location">10</a>                  </span>  </li></ul>
                 batch_number: @sale.batch_number ,unit_of_measure:@sale.unit_of_measure)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.batch_number 2 times                        <a href="sales_controller.html#L60" class="js-smell-location">0</a>                  <a href="sales_controller.html#L133" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.unit_of_measure 3 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L122" class="js-smell-location">1</a>                  <a href="sales_controller.html#L133" class="js-smell-location">2</a>                  </span>  </li></ul>

              if @sale.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.save 2 times                        <a href="sales_controller.html#L81" class="js-smell-location">0</a>                  <a href="sales_controller.html#L135" class="js-smell-location">1</a>                  </span>  </li></ul>
                # method to update stock if any item got saled
                  stock.quantity = stock.quantity - @sale.quantity<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.quantity 8 times                        <a href="sales_controller.html#L42" class="js-smell-location">0</a>                  <a href="sales_controller.html#L75" class="js-smell-location">1</a>                  <a href="sales_controller.html#L83" class="js-smell-location">2</a>                  <a href="sales_controller.html#L90" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L137" class="js-smell-location">5</a>                  <a href="sales_controller.html#L144" class="js-smell-location">6</a>                  <a href="sales_controller.html#L154" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls stock.quantity 2 times                        <a href="sales_controller.html#L83" class="js-smell-location">0</a>                  <a href="sales_controller.html#L137" class="js-smell-location">1</a>                  </span>  </li></ul>
                  stock.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls stock.save 2 times                        <a href="sales_controller.html#L84" class="js-smell-location">0</a>                  <a href="sales_controller.html#L138" class="js-smell-location">1</a>                  </span>  </li></ul>

                  #   handling total sold in Order table
                  order = Order.find_by(item_name: @sale.item_name , user_id: current_user.id)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.item_name 12 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L71" class="js-smell-location">2</a>                  <a href="sales_controller.html#L87" class="js-smell-location">3</a>                  <a href="sales_controller.html#L99" class="js-smell-location">4</a>                  <a href="sales_controller.html#L104" class="js-smell-location">5</a>                  <a href="sales_controller.html#L120" class="js-smell-location">6</a>                  <a href="sales_controller.html#L121" class="js-smell-location">7</a>                  <a href="sales_controller.html#L132" class="js-smell-location">8</a>                  <a href="sales_controller.html#L141" class="js-smell-location">9</a>                  <a href="sales_controller.html#L153" class="js-smell-location">10</a>                  <a href="sales_controller.html#L158" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls Order.find_by(item_name: @sale.item_name, user_id: current_user.id) 4 times                        <a href="sales_controller.html#L87" class="js-smell-location">0</a>                  <a href="sales_controller.html#L104" class="js-smell-location">1</a>                  <a href="sales_controller.html#L141" class="js-smell-location">2</a>                  <a href="sales_controller.html#L158" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls current_user.id 11 times                        <a href="sales_controller.html#L38" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L87" class="js-smell-location">2</a>                  <a href="sales_controller.html#L99" class="js-smell-location">3</a>                  <a href="sales_controller.html#L104" class="js-smell-location">4</a>                  <a href="sales_controller.html#L120" class="js-smell-location">5</a>                  <a href="sales_controller.html#L121" class="js-smell-location">6</a>                  <a href="sales_controller.html#L132" class="js-smell-location">7</a>                  <a href="sales_controller.html#L141" class="js-smell-location">8</a>                  <a href="sales_controller.html#L153" class="js-smell-location">9</a>                  <a href="sales_controller.html#L158" class="js-smell-location">10</a>                  </span>  </li></ul>

                  if order.present?<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.present? 4 times                        <a href="sales_controller.html#L89" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L143" class="js-smell-location">2</a>                  <a href="sales_controller.html#L159" class="js-smell-location">3</a>                  </span>  </li></ul>
                      order.sold = order.sold + (@sale.quantity )<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.quantity 8 times                        <a href="sales_controller.html#L42" class="js-smell-location">0</a>                  <a href="sales_controller.html#L75" class="js-smell-location">1</a>                  <a href="sales_controller.html#L83" class="js-smell-location">2</a>                  <a href="sales_controller.html#L90" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L137" class="js-smell-location">5</a>                  <a href="sales_controller.html#L144" class="js-smell-location">6</a>                  <a href="sales_controller.html#L154" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.sold 2 times                        <a href="sales_controller.html#L90" class="js-smell-location">0</a>                  <a href="sales_controller.html#L144" class="js-smell-location">1</a>                  </span>  </li></ul>
                      if order.last &lt; @sale.date_of_purchase<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.date_of_purchase 12 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L92" class="js-smell-location">1</a>                  <a href="sales_controller.html#L94" class="js-smell-location">2</a>                  <a href="sales_controller.html#L95" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L145" class="js-smell-location">5</a>                  <a href="sales_controller.html#L146" class="js-smell-location">6</a>                  <a href="sales_controller.html#L148" class="js-smell-location">7</a>                  <a href="sales_controller.html#L149" class="js-smell-location">8</a>                  <a href="sales_controller.html#L154" class="js-smell-location">9</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.last 6 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L106" class="js-smell-location">2</a>                  <a href="sales_controller.html#L145" class="js-smell-location">3</a>                  <a href="sales_controller.html#L159" class="js-smell-location">4</a>                  <a href="sales_controller.html#L160" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.last < @sale.date_of_purchase 2 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L145" class="js-smell-location">1</a>                  </span>  </li></ul>
                      order.last = @sale.date_of_purchase<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.date_of_purchase 12 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L92" class="js-smell-location">1</a>                  <a href="sales_controller.html#L94" class="js-smell-location">2</a>                  <a href="sales_controller.html#L95" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L145" class="js-smell-location">5</a>                  <a href="sales_controller.html#L146" class="js-smell-location">6</a>                  <a href="sales_controller.html#L148" class="js-smell-location">7</a>                  <a href="sales_controller.html#L149" class="js-smell-location">8</a>                  <a href="sales_controller.html#L154" class="js-smell-location">9</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.last = @sale.date_of_purchase 2 times                        <a href="sales_controller.html#L92" class="js-smell-location">0</a>                  <a href="sales_controller.html#L146" class="js-smell-location">1</a>                  </span>  </li></ul>
                      end
                      if order.first &gt; @sale.date_of_purchase<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.date_of_purchase 12 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L92" class="js-smell-location">1</a>                  <a href="sales_controller.html#L94" class="js-smell-location">2</a>                  <a href="sales_controller.html#L95" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L145" class="js-smell-location">5</a>                  <a href="sales_controller.html#L146" class="js-smell-location">6</a>                  <a href="sales_controller.html#L148" class="js-smell-location">7</a>                  <a href="sales_controller.html#L149" class="js-smell-location">8</a>                  <a href="sales_controller.html#L154" class="js-smell-location">9</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.first 6 times                        <a href="sales_controller.html#L94" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L107" class="js-smell-location">2</a>                  <a href="sales_controller.html#L148" class="js-smell-location">3</a>                  <a href="sales_controller.html#L159" class="js-smell-location">4</a>                  <a href="sales_controller.html#L161" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.first > @sale.date_of_purchase 2 times                        <a href="sales_controller.html#L94" class="js-smell-location">0</a>                  <a href="sales_controller.html#L148" class="js-smell-location">1</a>                  </span>  </li></ul>
                          order.first = @sale.date_of_purchase<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.date_of_purchase 12 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L92" class="js-smell-location">1</a>                  <a href="sales_controller.html#L94" class="js-smell-location">2</a>                  <a href="sales_controller.html#L95" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L145" class="js-smell-location">5</a>                  <a href="sales_controller.html#L146" class="js-smell-location">6</a>                  <a href="sales_controller.html#L148" class="js-smell-location">7</a>                  <a href="sales_controller.html#L149" class="js-smell-location">8</a>                  <a href="sales_controller.html#L154" class="js-smell-location">9</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.first = @sale.date_of_purchase 2 times                        <a href="sales_controller.html#L95" class="js-smell-location">0</a>                  <a href="sales_controller.html#L149" class="js-smell-location">1</a>                  </span>  </li></ul>
                      end
                      order.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.save 4 times                        <a href="sales_controller.html#L97" class="js-smell-location">0</a>                  <a href="sales_controller.html#L109" class="js-smell-location">1</a>                  <a href="sales_controller.html#L151" class="js-smell-location">2</a>                  <a href="sales_controller.html#L163" class="js-smell-location">3</a>                  </span>  </li></ul>
                  else
                      order = Order.create(user_id:current_user.id , item_name:@sale.item_name,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.item_name 12 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L71" class="js-smell-location">2</a>                  <a href="sales_controller.html#L87" class="js-smell-location">3</a>                  <a href="sales_controller.html#L99" class="js-smell-location">4</a>                  <a href="sales_controller.html#L104" class="js-smell-location">5</a>                  <a href="sales_controller.html#L120" class="js-smell-location">6</a>                  <a href="sales_controller.html#L121" class="js-smell-location">7</a>                  <a href="sales_controller.html#L132" class="js-smell-location">8</a>                  <a href="sales_controller.html#L141" class="js-smell-location">9</a>                  <a href="sales_controller.html#L153" class="js-smell-location">10</a>                  <a href="sales_controller.html#L158" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls current_user.id 11 times                        <a href="sales_controller.html#L38" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L87" class="js-smell-location">2</a>                  <a href="sales_controller.html#L99" class="js-smell-location">3</a>                  <a href="sales_controller.html#L104" class="js-smell-location">4</a>                  <a href="sales_controller.html#L120" class="js-smell-location">5</a>                  <a href="sales_controller.html#L121" class="js-smell-location">6</a>                  <a href="sales_controller.html#L132" class="js-smell-location">7</a>                  <a href="sales_controller.html#L141" class="js-smell-location">8</a>                  <a href="sales_controller.html#L153" class="js-smell-location">9</a>                  <a href="sales_controller.html#L158" class="js-smell-location">10</a>                  </span>  </li></ul>
                      sold:@sale.quantity,first:@sale.date_of_purchase,last:@sale.date_of_purchase)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.date_of_purchase 12 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L92" class="js-smell-location">1</a>                  <a href="sales_controller.html#L94" class="js-smell-location">2</a>                  <a href="sales_controller.html#L95" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L145" class="js-smell-location">5</a>                  <a href="sales_controller.html#L146" class="js-smell-location">6</a>                  <a href="sales_controller.html#L148" class="js-smell-location">7</a>                  <a href="sales_controller.html#L149" class="js-smell-location">8</a>                  <a href="sales_controller.html#L154" class="js-smell-location">9</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.quantity 8 times                        <a href="sales_controller.html#L42" class="js-smell-location">0</a>                  <a href="sales_controller.html#L75" class="js-smell-location">1</a>                  <a href="sales_controller.html#L83" class="js-smell-location">2</a>                  <a href="sales_controller.html#L90" class="js-smell-location">3</a>                  <a href="sales_controller.html#L100" class="js-smell-location">4</a>                  <a href="sales_controller.html#L137" class="js-smell-location">5</a>                  <a href="sales_controller.html#L144" class="js-smell-location">6</a>                  <a href="sales_controller.html#L154" class="js-smell-location">7</a>                  </span>  </li></ul>
                  end

                  #   in case when there is some conflicts between stock correction and manual feeding
                  order = Order.find_by(item_name: @sale.item_name , user_id: current_user.id)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.item_name 12 times                        <a href="sales_controller.html#L54" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L71" class="js-smell-location">2</a>                  <a href="sales_controller.html#L87" class="js-smell-location">3</a>                  <a href="sales_controller.html#L99" class="js-smell-location">4</a>                  <a href="sales_controller.html#L104" class="js-smell-location">5</a>                  <a href="sales_controller.html#L120" class="js-smell-location">6</a>                  <a href="sales_controller.html#L121" class="js-smell-location">7</a>                  <a href="sales_controller.html#L132" class="js-smell-location">8</a>                  <a href="sales_controller.html#L141" class="js-smell-location">9</a>                  <a href="sales_controller.html#L153" class="js-smell-location">10</a>                  <a href="sales_controller.html#L158" class="js-smell-location">11</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls Order.find_by(item_name: @sale.item_name, user_id: current_user.id) 4 times                        <a href="sales_controller.html#L87" class="js-smell-location">0</a>                  <a href="sales_controller.html#L104" class="js-smell-location">1</a>                  <a href="sales_controller.html#L141" class="js-smell-location">2</a>                  <a href="sales_controller.html#L158" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls current_user.id 11 times                        <a href="sales_controller.html#L38" class="js-smell-location">0</a>                  <a href="sales_controller.html#L59" class="js-smell-location">1</a>                  <a href="sales_controller.html#L87" class="js-smell-location">2</a>                  <a href="sales_controller.html#L99" class="js-smell-location">3</a>                  <a href="sales_controller.html#L104" class="js-smell-location">4</a>                  <a href="sales_controller.html#L120" class="js-smell-location">5</a>                  <a href="sales_controller.html#L121" class="js-smell-location">6</a>                  <a href="sales_controller.html#L132" class="js-smell-location">7</a>                  <a href="sales_controller.html#L141" class="js-smell-location">8</a>                  <a href="sales_controller.html#L153" class="js-smell-location">9</a>                  <a href="sales_controller.html#L158" class="js-smell-location">10</a>                  </span>  </li></ul>
                  if order.present? and order.last &lt; order.first<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.first 6 times                        <a href="sales_controller.html#L94" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L107" class="js-smell-location">2</a>                  <a href="sales_controller.html#L148" class="js-smell-location">3</a>                  <a href="sales_controller.html#L159" class="js-smell-location">4</a>                  <a href="sales_controller.html#L161" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.last 6 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L106" class="js-smell-location">2</a>                  <a href="sales_controller.html#L145" class="js-smell-location">3</a>                  <a href="sales_controller.html#L159" class="js-smell-location">4</a>                  <a href="sales_controller.html#L160" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.last < order.first 2 times                        <a href="sales_controller.html#L105" class="js-smell-location">0</a>                  <a href="sales_controller.html#L159" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.present? 4 times                        <a href="sales_controller.html#L89" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L143" class="js-smell-location">2</a>                  <a href="sales_controller.html#L159" class="js-smell-location">3</a>                  </span>  </li></ul>
                      temp= order.last<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Identical code found in 3 nodes                        <a href="sales_controller.html#L106" class="js-smell-location">0</a>                  <a href="sales_controller.html#L160" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L249" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.last 6 times                        <a href="sales_controller.html#L91" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L106" class="js-smell-location">2</a>                  <a href="sales_controller.html#L145" class="js-smell-location">3</a>                  <a href="sales_controller.html#L159" class="js-smell-location">4</a>                  <a href="sales_controller.html#L160" class="js-smell-location">5</a>                  </span>  </li></ul>
                      order.last = order.first<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.first 6 times                        <a href="sales_controller.html#L94" class="js-smell-location">0</a>                  <a href="sales_controller.html#L105" class="js-smell-location">1</a>                  <a href="sales_controller.html#L107" class="js-smell-location">2</a>                  <a href="sales_controller.html#L148" class="js-smell-location">3</a>                  <a href="sales_controller.html#L159" class="js-smell-location">4</a>                  <a href="sales_controller.html#L161" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.last = order.first 2 times                        <a href="sales_controller.html#L107" class="js-smell-location">0</a>                  <a href="sales_controller.html#L161" class="js-smell-location">1</a>                  </span>  </li></ul>
                      order.first = temp<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.first = temp 2 times                        <a href="sales_controller.html#L108" class="js-smell-location">0</a>                  <a href="sales_controller.html#L162" class="js-smell-location">1</a>                  </span>  </li></ul>
                      order.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls order.save 4 times                        <a href="sales_controller.html#L97" class="js-smell-location">0</a>                  <a href="sales_controller.html#L109" class="js-smell-location">1</a>                  <a href="sales_controller.html#L151" class="js-smell-location">2</a>                  <a href="sales_controller.html#L163" class="js-smell-location">3</a>                  </span>  </li></ul>
                  end

                    format.html { redirect_to @sale , notice: &#39;Sale was successfully created.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.html 8 times                        <a href="sales_controller.html#L43" class="js-smell-location">0</a>                  <a href="sales_controller.html#L50" class="js-smell-location">1</a>                  <a href="sales_controller.html#L64" class="js-smell-location">2</a>                  <a href="sales_controller.html#L79" class="js-smell-location">3</a>                  <a href="sales_controller.html#L111" class="js-smell-location">4</a>                  <a href="sales_controller.html#L126" class="js-smell-location">5</a>                  <a href="sales_controller.html#L129" class="js-smell-location">6</a>                  <a href="sales_controller.html#L166" class="js-smell-location">7</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.html do ... end 2 times                        <a href="sales_controller.html#L111" class="js-smell-location">0</a>                  <a href="sales_controller.html#L166" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls redirect_to(@sale, notice: "Sale was successfully created.") 2 times                        <a href="sales_controller.html#L111" class="js-smell-location">0</a>                  <a href="sales_controller.html#L166" class="js-smell-location">1</a>                  </span>  </li></ul>
                    format.json { render :show, status: :created, location: @sale }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.json 4 times                        <a href="sales_controller.html#L112" class="js-smell-location">0</a>                  <a href="sales_controller.html#L115" class="js-smell-location">1</a>                  <a href="sales_controller.html#L167" class="js-smell-location">2</a>                  <a href="sales_controller.html#L170" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.json do ... end 2 times                        <a href="sales_controller.html#L112" class="js-smell-location">0</a>                  <a href="sales_controller.html#L167" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls render(:show, status: :created, location: @sale) 2 times                        <a href="sales_controller.html#L112" class="js-smell-location">0</a>                  <a href="sales_controller.html#L167" class="js-smell-location">1</a>                  </span>  </li></ul>

              else
                format.json { render json: @sale.errors, status: :unprocessable_entity }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls @sale.errors 2 times                        <a href="sales_controller.html#L115" class="js-smell-location">0</a>                  <a href="sales_controller.html#L170" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls format.json 4 times                        <a href="sales_controller.html#L112" class="js-smell-location">0</a>                  <a href="sales_controller.html#L115" class="js-smell-location">1</a>                  <a href="sales_controller.html#L167" class="js-smell-location">2</a>                  <a href="sales_controller.html#L170" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#create calls render(json: @sale.errors, status: :unprocessable_entity) 2 times                        <a href="sales_controller.html#L115" class="js-smell-location">0</a>                  <a href="sales_controller.html#L170" class="js-smell-location">1</a>                  </span>  </li></ul>
              end
            end
        end
     end
    end
  end

  # PATCH/PUT /sales/1
  # PATCH/PUT /sales/1.json
  def update<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Similar code found in 4 nodes                        <a href="masters_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L191" class="js-smell-location">1</a>                  <a href="sales_controller.html#L180" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L163" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(TooManyStatements) SalesController#update has approx 9 statements          </span>  </li></ul>
    respond_to do |format|
      if @sale.update(sale_params)
        format.html { redirect_to @sale, notice: &#39;Sale was successfully updated.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#update calls format.html 2 times                        <a href="sales_controller.html#L183" class="js-smell-location">0</a>                  <a href="sales_controller.html#L186" class="js-smell-location">1</a>                  </span>  </li></ul>
        format.json { render :show, status: :ok, location: @sale }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#update calls format.json 2 times                        <a href="sales_controller.html#L184" class="js-smell-location">0</a>                  <a href="sales_controller.html#L187" class="js-smell-location">1</a>                  </span>  </li></ul>
      else
        format.html { render :edit }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#update calls format.html 2 times                        <a href="sales_controller.html#L183" class="js-smell-location">0</a>                  <a href="sales_controller.html#L186" class="js-smell-location">1</a>                  </span>  </li></ul>
        format.json { render json: @sale.errors, status: :unprocessable_entity }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) SalesController#update calls format.json 2 times                        <a href="sales_controller.html#L184" class="js-smell-location">0</a>                  <a href="sales_controller.html#L187" class="js-smell-location">1</a>                  </span>  </li></ul>
      end
    end
  end

  # DELETE /sales/1
  # DELETE /sales/1.json
  def destroy<ul class="nocode smells js-smells">  <li class="smell new">    <span class="description">(DuplicateCode) Similar code found in 3 nodes                        <a href="purchases_controller.html#L207" class="js-smell-location">0</a>                  <a href="sales_controller.html#L194" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L177" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(TooManyStatements) SalesController#destroy has approx 6 statements          </span>  </li></ul>
    @sale.destroy
    respond_to do |format|
      format.html { redirect_to sales_url, notice: &#39;Sale was successfully destroyed.&#39; }
      format.json { head :no_content }
    end
  end

  private

    # Use callbacks to share common setup or constraints between actions.
    def set_sale<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(UnusedPrivateMethod) SalesController has the unused private instance method `set_sale`          </span>  </li></ul>
      @sale = Sale.where(&quot;user_id = ?&quot; ,  current_user.id).find(params[:id])
    end

    # Never trust parameters from the scary internet, only allow the white list through.
    def sale_params
      params.require(:sale).permit(:customer, :item_name, :quantity, :unit_of_measure, :batch_number, :expiry_date, :date_of_purchase, :total_price)
    end


end
</code>

    </div>
    <script src='../../assets/javascripts/jquery-2.1.0.js'></script>
    <script src='../../assets/javascripts/jquery.tablesorter.js'></script>
    <script src='../../assets/javascripts/jquery.floatThead-v1.2.7.js'></script>
    <script src='../../assets/javascripts/jquery.timeago-v1.4.1.js'></script>
    <script src='../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../assets/javascripts/jquery.scrollTo-1.4.11.js'></script>
    <script src='../../assets/javascripts/prettify-4-Mar-2013.js'></script>
    <script src='../../assets/javascripts/application.js'></script>
  </body>
</html>
