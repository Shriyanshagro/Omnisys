<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>RubyCritic</title>
    <link href="../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <header class="project-header group">
      <div class="container">
        <h1 class="logo"><a href="../../overview.html" class="logo-link">RubyCritic</a></h1>
        <nav class="project-nav">
          <a href="../../overview.html" class="project-nav-item">Overview</a>
          <a href="../../code_index.html" class="project-nav-item">Code</a>
          <a href="../../smells_index.html" class="project-nav-item">Smells</a>
        </nav>
      </div>
    </header>
    <div class="container">
      <div class="file-header group rated">
  <span class="rating rating-f circled-text circle">
    F
  </span>
  <h2 class="file-name">PurchasesController</h2>

  <span class="file-committed-at">
    
      Updated <time class='js-timeago' datetime='2015-11-19 20:52:06 +0530'>2015-11-19 20:52:06 +0530</time>
    
  </span>

  <div class="file-stats group">
    <div class="file-stat">
      453 complexity
    </div>
    <div class="file-stat">
      37.8 complexity per method
    </div>
    <div class="file-stat">
      17 churn
    </div>
    <div class="file-stat">
      12 methods
    </div>
    <div class="file-stat">
      136 duplication
    </div>
  </div>

  
    <button id="js-toggle-smells" class="smells-toggle-button button">Toggle Smells</button>
  
</div>

<code class="prettyprint linenums lang-ruby file-code js-file-code">class PurchasesController &lt; ApplicationController<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(IrresponsibleModule) PurchasesController has no descriptive comment          </span>  </li>  <li class="smell old">    <span class="description">(TooManyInstanceVariables) PurchasesController has at least 5 instance variables          </span>  </li></ul>
  # authenticated to use only show method , i.e it can;t be updated , edit or  destroy
  before_action :authenticate_user!
  before_action :set_purchase, only: [:show]
  # GET /purchases
  # GET /purchases.json
  def index
    @purchases = Purchase.where(&quot;user_id = ?&quot; ,  current_user.id)
    Rack::MiniProfiler.config.position = &#39;right&#39;
  end

  # GET /purchases/1
  # GET /purchases/1.json
  def show
  end

  # GET /purchases/new
  def new
    @purchase = Purchase.new
  end

  # GET /purchases/1/edit
  def edit
  end


  # POST /purchases
  # POST /purchases.json
  def create<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(VeryHighComplexity) PurchasesController#create has a flog score of 358          </span>  </li>  <li class="smell old">    <span class="description">(TooManyStatements) PurchasesController#create has approx 55 statements          </span>  </li></ul>
    @purchase = Purchase.new(purchase_params)
    @purchase.user_id = current_user.id<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls current_user.id 12 times                        <a href="purchases_controller.html#L31" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">11</a>                  </span>  </li></ul>

    # stores current date only not
    time = Time.now.strftime(&quot;%Y-%m-%d&quot;)
    respond_to do |format|
     if @purchase.quantity&lt;=0<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity 14 times                        <a href="purchases_controller.html#L36" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L66" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L115" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">13</a>                  </span>  </li></ul>
        format.html { redirect_to @purchase, notice: &#39;Given quantity is not acceptable.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.html 7 times                        <a href="purchases_controller.html#L37" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L40" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L87" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L91" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L106" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L141" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L145" class="js-smell-location">6</a>                  </span>  </li></ul>

    elsif @purchase.expiry_date &lt;= Date.parse(time)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.expiry_date 4 times                        <a href="purchases_controller.html#L39" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">3</a>                  </span>  </li></ul>
        format.html { redirect_to @purchase, notice: &#39;Product is alreday expired, check the  expiry date&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.html 7 times                        <a href="purchases_controller.html#L37" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L40" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L87" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L91" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L106" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L141" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L145" class="js-smell-location">6</a>                  </span>  </li></ul>

     else
        #find weather given item and uom matches to master table
    validate = Master.find_by(item_name: @purchase.item_name , uom: @purchase.unit_of_measure)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.unit_of_measure 4 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L102" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L111" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L130" class="js-smell-location">3</a>                  </span>  </li></ul>

     if validate.present?
        # to find the unit_of_measure of least level
        factor = Master.find_by(item_name: @purchase.item_name , level: 1)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls Master.find_by(item_name: @purchase.item_name, level: 1) 2 times                        <a href="purchases_controller.html#L48" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">1</a>                  </span>  </li></ul>
       # logic to find least count of quantity
        $i=1
        $total=1
        while $i &lt;= validate.level<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Similar code found in 2 nodes                        <a href="purchases_controller.html#L52" class="js-smell-location">0</a>                  <a href="sales_controller.html#L70" class="js-smell-location">1</a>                  </span>  </li></ul>
            factor = Master.find_by(item_name: @purchase.item_name , level: $i)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li></ul>
            $total *= factor.units*factor.conversion
            $i += 1
        end
        factor = Master.find_by(item_name: @purchase.item_name , level: 1)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls Master.find_by(item_name: @purchase.item_name, level: 1) 2 times                        <a href="purchases_controller.html#L48" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">1</a>                  </span>  </li></ul>

       if @purchase.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.save 2 times                        <a href="purchases_controller.html#L59" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L98" class="js-smell-location">1</a>                  </span>  </li></ul>

           # method to update stock if any item got purchased
            stock = Stock.find_by(user_id: current_user.id , item_name: @purchase.item_name ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls Stock.find_by(user_id: current_user.id, item_name: @purchase.item_name, batch_number: @purchase.batch_number) 2 times                        <a href="purchases_controller.html#L62" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls current_user.id 12 times                        <a href="purchases_controller.html#L31" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">11</a>                  </span>  </li></ul>
             batch_number: @purchase.batch_number )<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.batch_number 5 times                        <a href="purchases_controller.html#L63" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L72" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L111" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L121" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L130" class="js-smell-location">4</a>                  </span>  </li></ul>

            if stock.present?<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls stock.present? 2 times                        <a href="purchases_controller.html#L65" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L123" class="js-smell-location">1</a>                  </span>  </li></ul>
              stock.quantity = stock.quantity + @purchase.quantity*$total<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity * $total 6 times                        <a href="purchases_controller.html#L66" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity 14 times                        <a href="purchases_controller.html#L36" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L66" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L115" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">13</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls stock.quantity 2 times                        <a href="purchases_controller.html#L66" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">1</a>                  </span>  </li></ul>
              stock.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls stock.save 2 times                        <a href="purchases_controller.html#L67" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L126" class="js-smell-location">1</a>                  </span>  </li></ul>

            else
                # method to create stock if any item got purchased
              stock=Stock.create(user_id: current_user.id , item_name: @purchase.item_name ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls current_user.id 12 times                        <a href="purchases_controller.html#L31" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">11</a>                  </span>  </li></ul>
             batch_number: @purchase.batch_number ,unit_of_measure: factor.uom ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.batch_number 5 times                        <a href="purchases_controller.html#L63" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L72" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L111" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L121" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L130" class="js-smell-location">4</a>                  </span>  </li></ul>
             expiry_date: @purchase.expiry_date , quantity:@purchase.quantity*$total)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.expiry_date 4 times                        <a href="purchases_controller.html#L39" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity * $total 6 times                        <a href="purchases_controller.html#L66" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity 14 times                        <a href="purchases_controller.html#L36" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L66" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L115" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">13</a>                  </span>  </li></ul>

            end

            report = Report.find_by(item_name: @purchase.item_name , user_id: current_user.id)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls Report.find_by(item_name: @purchase.item_name, user_id: current_user.id) 2 times                        <a href="purchases_controller.html#L77" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls current_user.id 12 times                        <a href="purchases_controller.html#L31" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">11</a>                  </span>  </li></ul>
            if report.present?
              report.value = (@purchase.total_price + report.value*report.quantity)/(@purchase.quantity*$total + report.quantity)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity * $total 6 times                        <a href="purchases_controller.html#L66" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity 14 times                        <a href="purchases_controller.html#L36" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L66" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L115" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">13</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.total_price + (report.value * report.quantity) 2 times                        <a href="purchases_controller.html#L79" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.total_price 4 times                        <a href="purchases_controller.html#L79" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls report.quantity 6 times                        <a href="purchases_controller.html#L79" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls report.value * report.quantity 2 times                        <a href="purchases_controller.html#L79" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls report.value 2 times                        <a href="purchases_controller.html#L79" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">1</a>                  </span>  </li></ul>
              report.quantity = report.quantity + @purchase.quantity*$total<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity * $total 6 times                        <a href="purchases_controller.html#L66" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity 14 times                        <a href="purchases_controller.html#L36" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L66" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L115" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">13</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls report.quantity 6 times                        <a href="purchases_controller.html#L79" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">3</a>                  </span>  </li></ul>
              report.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls report.save 2 times                        <a href="purchases_controller.html#L81" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L137" class="js-smell-location">1</a>                  </span>  </li></ul>
            else
              report=Report.create(user_id:current_user.id , item_name:@purchase.item_name,value:(@purchase.total_price/(@purchase.quantity*$total)),<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity * $total 6 times                        <a href="purchases_controller.html#L66" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity 14 times                        <a href="purchases_controller.html#L36" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L66" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L115" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">13</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.total_price 4 times                        <a href="purchases_controller.html#L79" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls current_user.id 12 times                        <a href="purchases_controller.html#L31" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">11</a>                  </span>  </li></ul>
              quantity:@purchase.quantity*$total)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity * $total 6 times                        <a href="purchases_controller.html#L66" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">5</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity 14 times                        <a href="purchases_controller.html#L36" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L66" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L115" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">13</a>                  </span>  </li></ul>
            end

            format.html { redirect_to @purchase, notice: &#39;Purchase was successfully created.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.html 7 times                        <a href="purchases_controller.html#L37" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L40" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L87" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L91" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L106" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L141" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L145" class="js-smell-location">6</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.html do ... end 2 times                        <a href="purchases_controller.html#L87" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L141" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls redirect_to(@purchase, notice: "Purchase was successfully created.") 2 times                        <a href="purchases_controller.html#L87" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L141" class="js-smell-location">1</a>                  </span>  </li></ul>
            format.json { render :show, status: :created, location: @purchase }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.json 4 times                        <a href="purchases_controller.html#L88" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L92" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L142" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L146" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.json do ... end 2 times                        <a href="purchases_controller.html#L88" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L142" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls render(:show, status: :created, location: @purchase) 2 times                        <a href="purchases_controller.html#L88" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L142" class="js-smell-location">1</a>                  </span>  </li></ul>

        else
            format.html { render :new }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.html 7 times                        <a href="purchases_controller.html#L37" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L40" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L87" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L91" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L106" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L141" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L145" class="js-smell-location">6</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls render(:new) 2 times                        <a href="purchases_controller.html#L91" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L145" class="js-smell-location">1</a>                  </span>  </li></ul>
            format.json { render json: @purchase.errors, status: :unprocessable_entity }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.errors 2 times                        <a href="purchases_controller.html#L92" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L146" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.json 4 times                        <a href="purchases_controller.html#L88" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L92" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L142" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L146" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls render(json: @purchase.errors, status: :unprocessable_entity) 2 times                        <a href="purchases_controller.html#L92" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L146" class="js-smell-location">1</a>                  </span>  </li></ul>

        end

        # if item is not from masters list but personal
     else
         if @purchase.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.save 2 times                        <a href="purchases_controller.html#L59" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L98" class="js-smell-location">1</a>                  </span>  </li></ul>

             stock_item = Stock.find_by(user_id: current_user.id , item_name: @purchase.item_name )<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls current_user.id 12 times                        <a href="purchases_controller.html#L31" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">11</a>                  </span>  </li></ul>
             stock_uom = Stock.find_by(user_id: current_user.id , item_name: @purchase.item_name ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls current_user.id 12 times                        <a href="purchases_controller.html#L31" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">11</a>                  </span>  </li></ul>
                   unit_of_measure:@purchase.unit_of_measure)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.unit_of_measure 4 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L102" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L111" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L130" class="js-smell-location">3</a>                  </span>  </li></ul>

                   #Only one uom is allowed for personal items.
             if stock_item.present? and !stock_uom.present?<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls !stock_uom.present? 2 times                        <a href="purchases_controller.html#L105" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L109" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls stock_item.present? 3 times                        <a href="purchases_controller.html#L105" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L109" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L118" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls stock_uom.present? 3 times                        <a href="purchases_controller.html#L105" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L109" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L118" class="js-smell-location">2</a>                  </span>  </li></ul>
                  format.html { redirect_to @purchase, notice: &#39;Only one uom is allowed for personal items.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.html 7 times                        <a href="purchases_controller.html#L37" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L40" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L87" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L91" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L106" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L141" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L145" class="js-smell-location">6</a>                  </span>  </li></ul>

                  # create a new item in personal list
             elsif !stock_item.present? and !stock_uom.present?<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls !stock_uom.present? 2 times                        <a href="purchases_controller.html#L105" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L109" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls stock_item.present? 3 times                        <a href="purchases_controller.html#L105" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L109" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L118" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls stock_uom.present? 3 times                        <a href="purchases_controller.html#L105" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L109" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L118" class="js-smell-location">2</a>                  </span>  </li></ul>
                 stock=Stock.create(user_id: current_user.id , item_name: @purchase.item_name ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Identical code found in 2 nodes                        <a href="purchases_controller.html#L110" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls Stock.create(user_id: current_user.id, item_name: @purchase.item_name, batch_number: @purchase.batch_number, unit_of_measure: @purchase.unit_of_measure, expiry_date: @purchase.expiry_date, quantity: @purchase.quantity) 2 times                        <a href="purchases_controller.html#L110" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls current_user.id 12 times                        <a href="purchases_controller.html#L31" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">11</a>                  </span>  </li></ul>
                batch_number: @purchase.batch_number ,unit_of_measure: @purchase.unit_of_measure ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.batch_number 5 times                        <a href="purchases_controller.html#L63" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L72" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L111" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L121" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L130" class="js-smell-location">4</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.unit_of_measure 4 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L102" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L111" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L130" class="js-smell-location">3</a>                  </span>  </li></ul>
                expiry_date: @purchase.expiry_date , quantity: @purchase.quantity)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.expiry_date 4 times                        <a href="purchases_controller.html#L39" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity 14 times                        <a href="purchases_controller.html#L36" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L66" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L115" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">13</a>                  </span>  </li></ul>

                report=Report.create(user_id:current_user.id , item_name:@purchase.item_name,value:(@purchase.total_price/(@purchase.quantity)),<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity 14 times                        <a href="purchases_controller.html#L36" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L66" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L115" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">13</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.total_price 4 times                        <a href="purchases_controller.html#L79" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls current_user.id 12 times                        <a href="purchases_controller.html#L31" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">11</a>                  </span>  </li></ul>
                quantity:@purchase.quantity)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity 14 times                        <a href="purchases_controller.html#L36" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L66" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L115" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">13</a>                  </span>  </li></ul>

                 # update the  stock level
             elsif  stock_item.present? and stock_uom.present?<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls stock_item.present? 3 times                        <a href="purchases_controller.html#L105" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L109" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L118" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls stock_uom.present? 3 times                        <a href="purchases_controller.html#L105" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L109" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L118" class="js-smell-location">2</a>                  </span>  </li></ul>

                         stock = Stock.find_by(user_id: current_user.id , item_name: @purchase.item_name ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls Stock.find_by(user_id: current_user.id, item_name: @purchase.item_name, batch_number: @purchase.batch_number) 2 times                        <a href="purchases_controller.html#L62" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls current_user.id 12 times                        <a href="purchases_controller.html#L31" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">11</a>                  </span>  </li></ul>
                          batch_number: @purchase.batch_number )<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.batch_number 5 times                        <a href="purchases_controller.html#L63" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L72" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L111" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L121" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L130" class="js-smell-location">4</a>                  </span>  </li></ul>

                         if stock.present?<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls stock.present? 2 times                        <a href="purchases_controller.html#L65" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L123" class="js-smell-location">1</a>                  </span>  </li></ul>

                           stock.quantity = stock.quantity + @purchase.quantity<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity 14 times                        <a href="purchases_controller.html#L36" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L66" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L115" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">13</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls stock.quantity 2 times                        <a href="purchases_controller.html#L66" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">1</a>                  </span>  </li></ul>
                           stock.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls stock.save 2 times                        <a href="purchases_controller.html#L67" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L126" class="js-smell-location">1</a>                  </span>  </li></ul>

                         else
                           stock=Stock.create(user_id: current_user.id , item_name: @purchase.item_name ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Identical code found in 2 nodes                        <a href="purchases_controller.html#L110" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls Stock.create(user_id: current_user.id, item_name: @purchase.item_name, batch_number: @purchase.batch_number, unit_of_measure: @purchase.unit_of_measure, expiry_date: @purchase.expiry_date, quantity: @purchase.quantity) 2 times                        <a href="purchases_controller.html#L110" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls current_user.id 12 times                        <a href="purchases_controller.html#L31" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">11</a>                  </span>  </li></ul>
                          batch_number: @purchase.batch_number ,unit_of_measure: @purchase.unit_of_measure ,<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.batch_number 5 times                        <a href="purchases_controller.html#L63" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L72" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L111" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L121" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L130" class="js-smell-location">4</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.unit_of_measure 4 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L102" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L111" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L130" class="js-smell-location">3</a>                  </span>  </li></ul>
                          expiry_date: @purchase.expiry_date , quantity: @purchase.quantity)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.expiry_date 4 times                        <a href="purchases_controller.html#L39" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity 14 times                        <a href="purchases_controller.html#L36" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L66" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L115" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">13</a>                  </span>  </li></ul>

                         end
                       report = Report.find_by(item_name: @purchase.item_name , user_id: current_user.id)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.item_name 15 times                        <a href="purchases_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L48" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L53" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L57" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">13</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">14</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls Report.find_by(item_name: @purchase.item_name, user_id: current_user.id) 2 times                        <a href="purchases_controller.html#L77" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls current_user.id 12 times                        <a href="purchases_controller.html#L31" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L62" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L71" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L77" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L100" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L101" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L110" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L120" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L129" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L134" class="js-smell-location">11</a>                  </span>  </li></ul>
                       report.value = (@purchase.total_price + report.value*report.quantity)/(@purchase.quantity + report.quantity)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity 14 times                        <a href="purchases_controller.html#L36" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L66" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L115" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">13</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.total_price + (report.value * report.quantity) 2 times                        <a href="purchases_controller.html#L79" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.total_price 4 times                        <a href="purchases_controller.html#L79" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls report.quantity 6 times                        <a href="purchases_controller.html#L79" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls report.value * report.quantity 2 times                        <a href="purchases_controller.html#L79" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls report.value 2 times                        <a href="purchases_controller.html#L79" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">1</a>                  </span>  </li></ul>
                       report.quantity = report.quantity + @purchase.quantity<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.quantity 14 times                        <a href="purchases_controller.html#L36" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L66" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L73" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L79" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L83" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L84" class="js-smell-location">6</a>                  <a href="purchases_controller.html#L112" class="js-smell-location">7</a>                  <a href="purchases_controller.html#L114" class="js-smell-location">8</a>                  <a href="purchases_controller.html#L115" class="js-smell-location">9</a>                  <a href="purchases_controller.html#L125" class="js-smell-location">10</a>                  <a href="purchases_controller.html#L131" class="js-smell-location">11</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">12</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">13</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls report.quantity 6 times                        <a href="purchases_controller.html#L79" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L80" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L135" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L136" class="js-smell-location">3</a>                  </span>  </li></ul>
                       report.save<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls report.save 2 times                        <a href="purchases_controller.html#L81" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L137" class="js-smell-location">1</a>                  </span>  </li></ul>

             end

             format.html { redirect_to @purchase, notice: &#39;Purchase was successfully created.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.html 7 times                        <a href="purchases_controller.html#L37" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L40" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L87" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L91" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L106" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L141" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L145" class="js-smell-location">6</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.html do ... end 2 times                        <a href="purchases_controller.html#L87" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L141" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls redirect_to(@purchase, notice: "Purchase was successfully created.") 2 times                        <a href="purchases_controller.html#L87" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L141" class="js-smell-location">1</a>                  </span>  </li></ul>
             format.json { render :show, status: :created, location: @purchase }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.json 4 times                        <a href="purchases_controller.html#L88" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L92" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L142" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L146" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.json do ... end 2 times                        <a href="purchases_controller.html#L88" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L142" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls render(:show, status: :created, location: @purchase) 2 times                        <a href="purchases_controller.html#L88" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L142" class="js-smell-location">1</a>                  </span>  </li></ul>

         else
             format.html { render :new }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.html 7 times                        <a href="purchases_controller.html#L37" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L40" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L87" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L91" class="js-smell-location">3</a>                  <a href="purchases_controller.html#L106" class="js-smell-location">4</a>                  <a href="purchases_controller.html#L141" class="js-smell-location">5</a>                  <a href="purchases_controller.html#L145" class="js-smell-location">6</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls render(:new) 2 times                        <a href="purchases_controller.html#L91" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L145" class="js-smell-location">1</a>                  </span>  </li></ul>
             format.json { render json: @purchase.errors, status: :unprocessable_entity }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls @purchase.errors 2 times                        <a href="purchases_controller.html#L92" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L146" class="js-smell-location">1</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls format.json 4 times                        <a href="purchases_controller.html#L88" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L92" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L142" class="js-smell-location">2</a>                  <a href="purchases_controller.html#L146" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#create calls render(json: @purchase.errors, status: :unprocessable_entity) 2 times                        <a href="purchases_controller.html#L92" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L146" class="js-smell-location">1</a>                  </span>  </li></ul>
         end
     end
     end
    end
  end

#   to send all wholesaler names ,associated to a specific user_id ,in form of json
  def wholesaler
      @wholesaler = Purchase.where(&quot;user_id = ?&quot; ,  current_user.id).distinct.pluck(:wholesaler)
  #   send date in form of json
  render json: @wholesaler
  end

#   to send item names&#39; of particualar items ,associated to a specific user_id and master list ,in form of json
  def item
     @item = Master.distinct.pluck(:item_name )
     @item += Stock.where(&quot;user_id = ?&quot; , current_user.id).distinct.pluck(:item_name )
    #  now to get distinct items from master and personal list
     @item = @item.uniq
     #   send date in form of json
     render json: @item
  end

#   to send unit_of_measures(uom) of a particualar item ,in form of json
  def uom<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(HighComplexity) PurchasesController#uom has a flog score of 29          </span>  </li></ul>
      #   conditions =&gt; in Url item_name(:name) should be available
      #  Url generated from Js script function =&gt; getuom() of _form.html.erb file under Views of different controllers
      if params[:name].present?<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#uom calls params[:name] 3 times                        <a href="purchases_controller.html#L174" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L175" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L180" class="js-smell-location">2</a>                  </span>  </li></ul>
            @uom = Master.where(&quot;item_name = ?&quot; , params[:name]).distinct.pluck(:uom)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#uom calls params[:name] 3 times                        <a href="purchases_controller.html#L174" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L175" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L180" class="js-smell-location">2</a>                  </span>  </li></ul>
            if @uom.present?
                #   send date in form of json
                render json: @uom<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#uom calls render(json: @uom) 2 times                        <a href="purchases_controller.html#L178" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L182" class="js-smell-location">1</a>                  </span>  </li></ul>
            else
                    @uom = Stock.where(&quot;item_name = ? and user_id = ?&quot; , params[:name], current_user.id).distinct.pluck(:unit_of_measure)<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#uom calls params[:name] 3 times                        <a href="purchases_controller.html#L174" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L175" class="js-smell-location">1</a>                  <a href="purchases_controller.html#L180" class="js-smell-location">2</a>                  </span>  </li></ul>
                    #   send date in form of json
                    render json: @uom<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#uom calls render(json: @uom) 2 times                        <a href="purchases_controller.html#L178" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L182" class="js-smell-location">1</a>                  </span>  </li></ul>
            end

      end

  end

  # PATCH/PUT /purchases/1
  # PATCH/PUT /purchases/1.json
  def update<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateCode) Similar code found in 4 nodes                        <a href="masters_controller.html#L44" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L191" class="js-smell-location">1</a>                  <a href="sales_controller.html#L180" class="js-smell-location">2</a>                  <a href="stocks_controller.html#L163" class="js-smell-location">3</a>                  </span>  </li>  <li class="smell old">    <span class="description">(TooManyStatements) PurchasesController#update has approx 9 statements          </span>  </li></ul>
    respond_to do |format|
      if @purchase.update(purchase_params)
        format.html { redirect_to @purchase, notice: &#39;Purchase was successfully updated.&#39; }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#update calls format.html 2 times                        <a href="purchases_controller.html#L194" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L199" class="js-smell-location">1</a>                  </span>  </li></ul>
        format.json { render :show, status: :ok, location: @purchase }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#update calls format.json 2 times                        <a href="purchases_controller.html#L195" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L200" class="js-smell-location">1</a>                  </span>  </li></ul>


      else
        format.html { render :edit }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#update calls format.html 2 times                        <a href="purchases_controller.html#L194" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L199" class="js-smell-location">1</a>                  </span>  </li></ul>
        format.json { render json: @purchase.errors, status: :unprocessable_entity }<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(DuplicateMethodCall) PurchasesController#update calls format.json 2 times                        <a href="purchases_controller.html#L195" class="js-smell-location">0</a>                  <a href="purchases_controller.html#L200" class="js-smell-location">1</a>                  </span>  </li></ul>
      end
    end
  end

  # DELETE /purchases/1
  # DELETE /purchases/1.json
  def destroy<ul class="nocode smells js-smells">  <li class="smell new">    <span class="description">(DuplicateCode) Similar code found in 3 nodes                        <a href="purchases_controller.html#L207" class="js-smell-location">0</a>                  <a href="sales_controller.html#L194" class="js-smell-location">1</a>                  <a href="stocks_controller.html#L177" class="js-smell-location">2</a>                  </span>  </li>  <li class="smell old">    <span class="description">(TooManyStatements) PurchasesController#destroy has approx 6 statements          </span>  </li></ul>
    @purchase.destroy

    respond_to do |format|
      format.html { redirect_to purchases_url, notice: &#39;Purchase was successfully destroyed.&#39; }
      format.json { head :no_content }
    end
  end

  private
    # Use callbacks to share common setup or constraints between actions.
    def set_purchase<ul class="nocode smells js-smells">  <li class="smell old">    <span class="description">(UnusedPrivateMethod) PurchasesController has the unused private instance method `set_purchase`          </span>  </li></ul>
      @purchase = Purchase.where(&quot;user_id = ?&quot; , current_user.id).find(params[:id])

    end

    # Never trust parameters from the scary internet, only allow the white list through.
    def purchase_params
      params.require(:purchase).permit(:wholesaler, :item_name, :quantity, :unit_of_measure, :batch_number, :expiry_date, :date_of_purchase, :total_price)
    end



end
</code>

    </div>
    <script src='../../assets/javascripts/jquery-2.1.0.js'></script>
    <script src='../../assets/javascripts/jquery.tablesorter.js'></script>
    <script src='../../assets/javascripts/jquery.floatThead-v1.2.7.js'></script>
    <script src='../../assets/javascripts/jquery.timeago-v1.4.1.js'></script>
    <script src='../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../assets/javascripts/jquery.scrollTo-1.4.11.js'></script>
    <script src='../../assets/javascripts/prettify-4-Mar-2013.js'></script>
    <script src='../../assets/javascripts/application.js'></script>
  </body>
</html>
